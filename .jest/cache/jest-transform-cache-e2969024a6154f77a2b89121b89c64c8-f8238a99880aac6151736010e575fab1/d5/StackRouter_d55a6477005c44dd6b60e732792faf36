d40d8df0a580e8605b6206ec79521bb3
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = StackRouter;
exports.StackActions = void 0;

var _nonSecure = require("nanoid/non-secure");

var _BaseRouter = _interopRequireDefault(require("./BaseRouter"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var StackActions = {
  replace: function replace(name, params) {
    return {
      type: 'REPLACE',
      payload: {
        name: name,
        params: params
      }
    };
  },
  push: function push(name, params) {
    return {
      type: 'PUSH',
      payload: {
        name: name,
        params: params
      }
    };
  },
  pop: function pop() {
    var count = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    return {
      type: 'POP',
      payload: {
        count: count
      }
    };
  },
  popToTop: function popToTop() {
    return {
      type: 'POP_TO_TOP'
    };
  }
};
exports.StackActions = StackActions;

function StackRouter(options) {
  var router = _objectSpread(_objectSpread({}, _BaseRouter.default), {}, {
    type: 'stack',
    getInitialState: function getInitialState(_ref) {
      var routeNames = _ref.routeNames,
          routeParamList = _ref.routeParamList;
      var initialRouteName = options.initialRouteName !== undefined && routeNames.includes(options.initialRouteName) ? options.initialRouteName : routeNames[0];
      return {
        stale: false,
        type: 'stack',
        key: "stack-".concat((0, _nonSecure.nanoid)()),
        index: 0,
        routeNames: routeNames,
        routes: [{
          key: "".concat(initialRouteName, "-").concat((0, _nonSecure.nanoid)()),
          name: initialRouteName,
          params: routeParamList[initialRouteName]
        }]
      };
    },
    getRehydratedState: function getRehydratedState(partialState, _ref2) {
      var routeNames = _ref2.routeNames,
          routeParamList = _ref2.routeParamList;
      var state = partialState;

      if (state.stale === false) {
        return state;
      }

      var routes = state.routes.filter(function (route) {
        return routeNames.includes(route.name);
      }).map(function (route) {
        return _objectSpread(_objectSpread({}, route), {}, {
          key: route.key || "".concat(route.name, "-").concat((0, _nonSecure.nanoid)()),
          params: routeParamList[route.name] !== undefined ? _objectSpread(_objectSpread({}, routeParamList[route.name]), route.params) : route.params
        });
      });

      if (routes.length === 0) {
        var initialRouteName = options.initialRouteName !== undefined ? options.initialRouteName : routeNames[0];
        routes.push({
          key: "".concat(initialRouteName, "-").concat((0, _nonSecure.nanoid)()),
          name: initialRouteName,
          params: routeParamList[initialRouteName]
        });
      }

      return {
        stale: false,
        type: 'stack',
        key: "stack-".concat((0, _nonSecure.nanoid)()),
        index: routes.length - 1,
        routeNames: routeNames,
        routes: routes
      };
    },
    getStateForRouteNamesChange: function getStateForRouteNamesChange(state, _ref3) {
      var routeNames = _ref3.routeNames,
          routeParamList = _ref3.routeParamList;
      var routes = state.routes.filter(function (route) {
        return routeNames.includes(route.name);
      });

      if (routes.length === 0) {
        var initialRouteName = options.initialRouteName !== undefined && routeNames.includes(options.initialRouteName) ? options.initialRouteName : routeNames[0];
        routes.push({
          key: "".concat(initialRouteName, "-").concat((0, _nonSecure.nanoid)()),
          name: initialRouteName,
          params: routeParamList[initialRouteName]
        });
      }

      return _objectSpread(_objectSpread({}, state), {}, {
        routeNames: routeNames,
        routes: routes,
        index: Math.min(state.index, routes.length - 1)
      });
    },
    getStateForRouteFocus: function getStateForRouteFocus(state, key) {
      var index = state.routes.findIndex(function (r) {
        return r.key === key;
      });

      if (index === -1 || index === state.index) {
        return state;
      }

      return _objectSpread(_objectSpread({}, state), {}, {
        index: index,
        routes: state.routes.slice(0, index + 1)
      });
    },
    getStateForAction: function getStateForAction(state, action, options) {
      var routeParamList = options.routeParamList;

      switch (action.type) {
        case 'REPLACE':
          {
            var index = action.target === state.key && action.source ? state.routes.findIndex(function (r) {
              return r.key === action.source;
            }) : state.index;

            if (index === -1) {
              return null;
            }

            var _action$payload = action.payload,
                name = _action$payload.name,
                key = _action$payload.key,
                params = _action$payload.params;

            if (!state.routeNames.includes(name)) {
              return null;
            }

            return _objectSpread(_objectSpread({}, state), {}, {
              routes: state.routes.map(function (route, i) {
                return i === index ? {
                  key: key !== undefined ? key : "".concat(name, "-").concat((0, _nonSecure.nanoid)()),
                  name: name,
                  params: routeParamList[name] !== undefined ? _objectSpread(_objectSpread({}, routeParamList[name]), params) : params
                } : route;
              })
            });
          }

        case 'PUSH':
          if (state.routeNames.includes(action.payload.name)) {
            var getId = options.routeGetIdList[action.payload.name];
            var id = getId === null || getId === void 0 ? void 0 : getId({
              params: action.payload.params
            });
            var route = action.payload.name && action.payload.key ? state.routes.find(function (route) {
              return route.name === action.payload.name && route.key === action.payload.key;
            }) : id ? state.routes.find(function (route) {
              return id === (getId === null || getId === void 0 ? void 0 : getId({
                params: route.params
              }));
            }) : undefined;
            var routes;

            if (route) {
              routes = state.routes.filter(function (r) {
                return r.key !== route.key;
              });
              routes.push(_objectSpread(_objectSpread({}, route), {}, {
                params: action.payload.params !== undefined ? _objectSpread(_objectSpread({}, route.params), action.payload.params) : route.params
              }));
            } else {
              var _action$payload$key;

              routes = [].concat((0, _toConsumableArray2.default)(state.routes), [{
                key: (_action$payload$key = action.payload.key) !== null && _action$payload$key !== void 0 ? _action$payload$key : "".concat(action.payload.name, "-").concat((0, _nonSecure.nanoid)()),
                name: action.payload.name,
                params: routeParamList[action.payload.name] !== undefined ? _objectSpread(_objectSpread({}, routeParamList[action.payload.name]), action.payload.params) : action.payload.params
              }]);
            }

            return _objectSpread(_objectSpread({}, state), {}, {
              index: routes.length - 1,
              routes: routes
            });
          }

          return null;

        case 'POP':
          {
            var _index = action.target === state.key && action.source ? state.routes.findIndex(function (r) {
              return r.key === action.source;
            }) : state.index;

            if (_index > 0) {
              var count = Math.max(_index - action.payload.count + 1, 1);

              var _routes = state.routes.slice(0, count).concat(state.routes.slice(_index + 1));

              return _objectSpread(_objectSpread({}, state), {}, {
                index: _routes.length - 1,
                routes: _routes
              });
            }

            return null;
          }

        case 'POP_TO_TOP':
          return router.getStateForAction(state, {
            type: 'POP',
            payload: {
              count: state.routes.length - 1
            }
          }, options);

        case 'NAVIGATE':
          if (action.payload.key || action.payload.name && state.routeNames.includes(action.payload.name)) {
            var _index2 = -1;

            var _getId = action.payload.key === undefined && action.payload.name !== undefined ? options.routeGetIdList[action.payload.name] : undefined;

            var _id = _getId === null || _getId === void 0 ? void 0 : _getId({
              params: action.payload.params
            });

            if (_id) {
              _index2 = state.routes.findIndex(function (route) {
                return _id === (_getId === null || _getId === void 0 ? void 0 : _getId({
                  params: route.params
                }));
              });
            } else if (state.routes[state.index].name === action.payload.name && action.payload.key === undefined || state.routes[state.index].key === action.payload.key) {
              _index2 = state.index;
            } else {
              for (var i = state.routes.length - 1; i >= 0; i--) {
                if (state.routes[i].name === action.payload.name && action.payload.key === undefined || state.routes[i].key === action.payload.key) {
                  _index2 = i;
                  break;
                }
              }
            }

            if (_index2 === -1 && action.payload.key && action.payload.name === undefined) {
              return null;
            }

            if (_index2 === -1 && action.payload.name !== undefined) {
              var _action$payload$key2;

              var _routes2 = [].concat((0, _toConsumableArray2.default)(state.routes), [{
                key: (_action$payload$key2 = action.payload.key) !== null && _action$payload$key2 !== void 0 ? _action$payload$key2 : "".concat(action.payload.name, "-").concat((0, _nonSecure.nanoid)()),
                name: action.payload.name,
                params: routeParamList[action.payload.name] !== undefined ? _objectSpread(_objectSpread({}, routeParamList[action.payload.name]), action.payload.params) : action.payload.params
              }]);

              return _objectSpread(_objectSpread({}, state), {}, {
                routes: _routes2,
                index: _routes2.length - 1
              });
            }

            var _route = state.routes[_index2];

            var _params;

            if (action.payload.merge === false) {
              _params = routeParamList[_route.name] !== undefined ? _objectSpread(_objectSpread({}, routeParamList[_route.name]), action.payload.params) : action.payload.params;
            } else {
              _params = action.payload.params ? _objectSpread(_objectSpread({}, _route.params), action.payload.params) : _route.params;
            }

            return _objectSpread(_objectSpread({}, state), {}, {
              index: _index2,
              routes: [].concat((0, _toConsumableArray2.default)(state.routes.slice(0, _index2)), [_params !== _route.params ? _objectSpread(_objectSpread({}, _route), {}, {
                params: _params
              }) : state.routes[_index2]])
            });
          }

          return null;

        case 'GO_BACK':
          if (state.index > 0) {
            return router.getStateForAction(state, {
              type: 'POP',
              payload: {
                count: 1
              },
              target: action.target,
              source: action.source
            }, options);
          }

          return null;

        default:
          return _BaseRouter.default.getStateForAction(state, action);
      }
    },
    actionCreators: StackActions
  });

  return router;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YWNrUm91dGVyLnRzeCJdLCJuYW1lcyI6WyJTdGFja0FjdGlvbnMiLCJyZXBsYWNlIiwidHlwZSIsInBheWxvYWQiLCJuYW1lIiwicGFyYW1zIiwicHVzaCIsInBvcCIsImNvdW50IiwicG9wVG9Ub3AiLCJyb3V0ZXIiLCJCYXNlUm91dGVyIiwiZ2V0SW5pdGlhbFN0YXRlIiwicm91dGVQYXJhbUxpc3QiLCJpbml0aWFsUm91dGVOYW1lIiwib3B0aW9ucyIsInJvdXRlTmFtZXMiLCJzdGFsZSIsImtleSIsImluZGV4Iiwicm91dGVzIiwiZ2V0UmVoeWRyYXRlZFN0YXRlIiwic3RhdGUiLCJyb3V0ZSIsImdldFN0YXRlRm9yUm91dGVOYW1lc0NoYW5nZSIsIk1hdGgiLCJnZXRTdGF0ZUZvclJvdXRlRm9jdXMiLCJyIiwiZ2V0U3RhdGVGb3JBY3Rpb24iLCJhY3Rpb24iLCJnZXRJZCIsImlkIiwiaSIsInRhcmdldCIsInNvdXJjZSIsImFjdGlvbkNyZWF0b3JzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLFVBQUEsR0FBQSxPQUFBLENBQUEsbUJBQUEsQ0FBQTs7QUFDQSxJQUFBLFdBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsZ0JBQUEsQ0FBQTs7Ozs7Ozs7QUFrRk8sSUFBTUEsWUFBWSxHQUFHO0FBQzFCQyxFQUFBQSxPQUQwQixtQkFDbkIsSUFEbUIsRUFDbkIsTUFEbUIsRUFDOEI7QUFDdEQsV0FBTztBQUFFQyxNQUFBQSxJQUFJLEVBQU4sU0FBQTtBQUFtQkMsTUFBQUEsT0FBTyxFQUFFO0FBQUVDLFFBQUFBLElBQUYsRUFBRUEsSUFBRjtBQUFRQyxRQUFBQSxNQUFBQSxFQUFBQTtBQUFSO0FBQTVCLEtBQVA7QUFGd0IsR0FBQTtBQUkxQkMsRUFBQUEsSUFKMEIsZ0JBSXRCLElBSnNCLEVBSXRCLE1BSnNCLEVBSTJCO0FBQ25ELFdBQU87QUFBRUosTUFBQUEsSUFBSSxFQUFOLE1BQUE7QUFBZ0JDLE1BQUFBLE9BQU8s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QUFFRCxpQkFBQSxJQUFBOztBQUVGLGFBQUEsU0FBQTtBQUNFLGNBQUlBLEtBQUssQ0FBTEEsS0FBQUEsR0FBSixDQUFBLEVBQXFCO0FBQ25CLG1CQUFPLE1BQU0sQ0FBTixpQkFBQSxDQUFBLEtBQUEsRUFFTDtBQUNFcEIsY0FBQUEsSUFBSSxFQUROLEtBQUE7QUFFRUMsY0FBQUEsT0FBTyxFQUFFO0FBQUVLLGdCQUFBQSxLQUFLLEVBQUU7QUFBVCxlQUZYO0FBR0V5QixjQUFBQSxNQUFNLEVBQUVKLE1BQU0sQ0FIaEIsTUFBQTtBQUlFSyxjQUFBQSxNQUFNLEVBQUVMLE1BQU0sQ0FBQ0s7QUFKakIsYUFGSyxFQUFQLE9BQU8sQ0FBUDtBQVVEOztBQUVELGlCQUFBLElBQUE7O0FBRUY7QUFDRSxpQkFBT3ZCLFdBQUFBLENBQUFBLE9BQUFBLENBQUFBLGlCQUFBQSxDQUFBQSxLQUFBQSxFQUFQLE1BQU9BLENBQVA7QUE1UEo7QUF2SEEsS0FBSDtBQXVYQ3dCLElBQUFBLGNBQWMsRUFBRW5DO0FBdlhqQixJQUhEOztBQTZYQSxTQUFBLE1BQUE7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG5hbm9pZCB9IGZyb20gJ25hbm9pZC9ub24tc2VjdXJlJztcbmltcG9ydCBCYXNlUm91dGVyIGZyb20gJy4vQmFzZVJvdXRlcic7XG5pbXBvcnQgdHlwZSB7XG4gIE5hdmlnYXRpb25TdGF0ZSxcbiAgQ29tbW9uTmF2aWdhdGlvbkFjdGlvbixcbiAgUm91dGVyLFxuICBEZWZhdWx0Um91dGVyT3B0aW9ucyxcbiAgUm91dGUsXG4gIFBhcmFtTGlzdEJhc2UsXG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgdHlwZSBTdGFja0FjdGlvblR5cGUgPVxuICB8IHtcbiAgICAgIHR5cGU6ICdSRVBMQUNFJztcbiAgICAgIHBheWxvYWQ6IHsgbmFtZTogc3RyaW5nOyBrZXk/OiBzdHJpbmcgfCB1bmRlZmluZWQ7IHBhcmFtcz86IG9iamVjdCB9O1xuICAgICAgc291cmNlPzogc3RyaW5nO1xuICAgICAgdGFyZ2V0Pzogc3RyaW5nO1xuICAgIH1cbiAgfCB7XG4gICAgICB0eXBlOiAnUFVTSCc7XG4gICAgICBwYXlsb2FkOiB7IG5hbWU6IHN0cmluZzsga2V5Pzogc3RyaW5nIHwgdW5kZWZpbmVkOyBwYXJhbXM/OiBvYmplY3QgfTtcbiAgICAgIHNvdXJjZT86IHN0cmluZztcbiAgICAgIHRhcmdldD86IHN0cmluZztcbiAgICB9XG4gIHwge1xuICAgICAgdHlwZTogJ1BPUCc7XG4gICAgICBwYXlsb2FkOiB7IGNvdW50OiBudW1iZXIgfTtcbiAgICAgIHNvdXJjZT86IHN0cmluZztcbiAgICAgIHRhcmdldD86IHN0cmluZztcbiAgICB9XG4gIHwge1xuICAgICAgdHlwZTogJ1BPUF9UT19UT1AnO1xuICAgICAgc291cmNlPzogc3RyaW5nO1xuICAgICAgdGFyZ2V0Pzogc3RyaW5nO1xuICAgIH07XG5cbmV4cG9ydCB0eXBlIFN0YWNrUm91dGVyT3B0aW9ucyA9IERlZmF1bHRSb3V0ZXJPcHRpb25zO1xuXG5leHBvcnQgdHlwZSBTdGFja05hdmlnYXRpb25TdGF0ZTxcbiAgUGFyYW1MaXN0IGV4dGVuZHMgUGFyYW1MaXN0QmFzZVxuPiA9IE5hdmlnYXRpb25TdGF0ZTxQYXJhbUxpc3Q+ICYge1xuICAvKipcbiAgICogVHlwZSBvZiB0aGUgcm91dGVyLCBpbiB0aGlzIGNhc2UsIGl0J3Mgc3RhY2suXG4gICAqL1xuICB0eXBlOiAnc3RhY2snO1xufTtcblxuZXhwb3J0IHR5cGUgU3RhY2tBY3Rpb25IZWxwZXJzPFBhcmFtTGlzdCBleHRlbmRzIFBhcmFtTGlzdEJhc2U+ID0ge1xuICAvKipcbiAgICogUmVwbGFjZSB0aGUgY3VycmVudCByb3V0ZSB3aXRoIGEgbmV3IG9uZS5cbiAgICpcbiAgICogQHBhcmFtIG5hbWUgUm91dGUgbmFtZSBvZiB0aGUgbmV3IHJvdXRlLlxuICAgKiBAcGFyYW0gW3BhcmFtc10gUGFyYW1zIG9iamVjdCBmb3IgdGhlIG5ldyByb3V0ZS5cbiAgICovXG4gIHJlcGxhY2U8Um91dGVOYW1lIGV4dGVuZHMga2V5b2YgUGFyYW1MaXN0PihcbiAgICAuLi5hcmdzOiB1bmRlZmluZWQgZXh0ZW5kcyBQYXJhbUxpc3RbUm91dGVOYW1lXVxuICAgICAgPyBbUm91dGVOYW1lXSB8IFtSb3V0ZU5hbWUsIFBhcmFtTGlzdFtSb3V0ZU5hbWVdXVxuICAgICAgOiBbUm91dGVOYW1lLCBQYXJhbUxpc3RbUm91dGVOYW1lXV1cbiAgKTogdm9pZDtcblxuICAvKipcbiAgICogUHVzaCBhIG5ldyBzY3JlZW4gb250byB0aGUgc3RhY2suXG4gICAqXG4gICAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIHJvdXRlIGZvciB0aGUgdGFiLlxuICAgKiBAcGFyYW0gW3BhcmFtc10gUGFyYW1zIG9iamVjdCBmb3IgdGhlIHJvdXRlLlxuICAgKi9cbiAgcHVzaDxSb3V0ZU5hbWUgZXh0ZW5kcyBrZXlvZiBQYXJhbUxpc3Q+KFxuICAgIC4uLmFyZ3M6IHVuZGVmaW5lZCBleHRlbmRzIFBhcmFtTGlzdFtSb3V0ZU5hbWVdXG4gICAgICA/IFtSb3V0ZU5hbWVdIHwgW1JvdXRlTmFtZSwgUGFyYW1MaXN0W1JvdXRlTmFtZV1dXG4gICAgICA6IFtSb3V0ZU5hbWUsIFBhcmFtTGlzdFtSb3V0ZU5hbWVdXVxuICApOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBQb3AgYSBzY3JlZW4gZnJvbSB0aGUgc3RhY2suXG4gICAqL1xuICBwb3AoY291bnQ/OiBudW1iZXIpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBQb3AgdG8gdGhlIGZpcnN0IHJvdXRlIGluIHRoZSBzdGFjaywgZGlzbWlzc2luZyBhbGwgb3RoZXIgc2NyZWVucy5cbiAgICovXG4gIHBvcFRvVG9wKCk6IHZvaWQ7XG59O1xuXG5leHBvcnQgY29uc3QgU3RhY2tBY3Rpb25zID0ge1xuICByZXBsYWNlKG5hbWU6IHN0cmluZywgcGFyYW1zPzogb2JqZWN0KTogU3RhY2tBY3Rpb25UeXBlIHtcbiAgICByZXR1cm4geyB0eXBlOiAnUkVQTEFDRScsIHBheWxvYWQ6IHsgbmFtZSwgcGFyYW1zIH0gfTtcbiAgfSxcbiAgcHVzaChuYW1lOiBzdHJpbmcsIHBhcmFtcz86IG9iamVjdCk6IFN0YWNrQWN0aW9uVHlwZSB7XG4gICAgcmV0dXJuIHsgdHlwZTogJ1BVU0gnLCBwYXlsb2FkOiB7IG5hbWUsIHBhcmFtcyB9IH07XG4gIH0sXG4gIHBvcChjb3VudDogbnVtYmVyID0gMSk6IFN0YWNrQWN0aW9uVHlwZSB7XG4gICAgcmV0dXJuIHsgdHlwZTogJ1BPUCcsIHBheWxvYWQ6IHsgY291bnQgfSB9O1xuICB9LFxuICBwb3BUb1RvcCgpOiBTdGFja0FjdGlvblR5cGUge1xuICAgIHJldHVybiB7IHR5cGU6ICdQT1BfVE9fVE9QJyB9O1xuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gU3RhY2tSb3V0ZXIob3B0aW9uczogU3RhY2tSb3V0ZXJPcHRpb25zKSB7XG4gIGNvbnN0IHJvdXRlcjogUm91dGVyPFxuICAgIFN0YWNrTmF2aWdhdGlvblN0YXRlPFBhcmFtTGlzdEJhc2U+LFxuICAgIENvbW1vbk5hdmlnYXRpb25BY3Rpb24gfCBTdGFja0FjdGlvblR5cGVcbiAgPiA9IHtcbiAgICAuLi5CYXNlUm91dGVyLFxuXG4gICAgdHlwZTogJ3N0YWNrJyxcblxuICAgIGdldEluaXRpYWxTdGF0ZSh7IHJvdXRlTmFtZXMsIHJvdXRlUGFyYW1MaXN0IH0pIHtcbiAgICAgIGNvbnN0IGluaXRpYWxSb3V0ZU5hbWUgPVxuICAgICAgICBvcHRpb25zLmluaXRpYWxSb3V0ZU5hbWUgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICByb3V0ZU5hbWVzLmluY2x1ZGVzKG9wdGlvbnMuaW5pdGlhbFJvdXRlTmFtZSlcbiAgICAgICAgICA/IG9wdGlvbnMuaW5pdGlhbFJvdXRlTmFtZVxuICAgICAgICAgIDogcm91dGVOYW1lc1swXTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhbGU6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnc3RhY2snLFxuICAgICAgICBrZXk6IGBzdGFjay0ke25hbm9pZCgpfWAsXG4gICAgICAgIGluZGV4OiAwLFxuICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICByb3V0ZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBrZXk6IGAke2luaXRpYWxSb3V0ZU5hbWV9LSR7bmFub2lkKCl9YCxcbiAgICAgICAgICAgIG5hbWU6IGluaXRpYWxSb3V0ZU5hbWUsXG4gICAgICAgICAgICBwYXJhbXM6IHJvdXRlUGFyYW1MaXN0W2luaXRpYWxSb3V0ZU5hbWVdLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICBnZXRSZWh5ZHJhdGVkU3RhdGUocGFydGlhbFN0YXRlLCB7IHJvdXRlTmFtZXMsIHJvdXRlUGFyYW1MaXN0IH0pIHtcbiAgICAgIGxldCBzdGF0ZSA9IHBhcnRpYWxTdGF0ZTtcblxuICAgICAgaWYgKHN0YXRlLnN0YWxlID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJvdXRlcyA9IHN0YXRlLnJvdXRlc1xuICAgICAgICAuZmlsdGVyKChyb3V0ZSkgPT4gcm91dGVOYW1lcy5pbmNsdWRlcyhyb3V0ZS5uYW1lKSlcbiAgICAgICAgLm1hcChcbiAgICAgICAgICAocm91dGUpID0+XG4gICAgICAgICAgICAoe1xuICAgICAgICAgICAgICAuLi5yb3V0ZSxcbiAgICAgICAgICAgICAga2V5OiByb3V0ZS5rZXkgfHwgYCR7cm91dGUubmFtZX0tJHtuYW5vaWQoKX1gLFxuICAgICAgICAgICAgICBwYXJhbXM6XG4gICAgICAgICAgICAgICAgcm91dGVQYXJhbUxpc3Rbcm91dGUubmFtZV0gIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgLi4ucm91dGVQYXJhbUxpc3Rbcm91dGUubmFtZV0sXG4gICAgICAgICAgICAgICAgICAgICAgLi4ucm91dGUucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICA6IHJvdXRlLnBhcmFtcyxcbiAgICAgICAgICAgIH0gYXMgUm91dGU8c3RyaW5nPilcbiAgICAgICAgKTtcblxuICAgICAgaWYgKHJvdXRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc3QgaW5pdGlhbFJvdXRlTmFtZSA9XG4gICAgICAgICAgb3B0aW9ucy5pbml0aWFsUm91dGVOYW1lICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgID8gb3B0aW9ucy5pbml0aWFsUm91dGVOYW1lXG4gICAgICAgICAgICA6IHJvdXRlTmFtZXNbMF07XG5cbiAgICAgICAgcm91dGVzLnB1c2goe1xuICAgICAgICAgIGtleTogYCR7aW5pdGlhbFJvdXRlTmFtZX0tJHtuYW5vaWQoKX1gLFxuICAgICAgICAgIG5hbWU6IGluaXRpYWxSb3V0ZU5hbWUsXG4gICAgICAgICAgcGFyYW1zOiByb3V0ZVBhcmFtTGlzdFtpbml0aWFsUm91dGVOYW1lXSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YWxlOiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ3N0YWNrJyxcbiAgICAgICAga2V5OiBgc3RhY2stJHtuYW5vaWQoKX1gLFxuICAgICAgICBpbmRleDogcm91dGVzLmxlbmd0aCAtIDEsXG4gICAgICAgIHJvdXRlTmFtZXMsXG4gICAgICAgIHJvdXRlcyxcbiAgICAgIH07XG4gICAgfSxcblxuICAgIGdldFN0YXRlRm9yUm91dGVOYW1lc0NoYW5nZShzdGF0ZSwgeyByb3V0ZU5hbWVzLCByb3V0ZVBhcmFtTGlzdCB9KSB7XG4gICAgICBjb25zdCByb3V0ZXMgPSBzdGF0ZS5yb3V0ZXMuZmlsdGVyKChyb3V0ZSkgPT5cbiAgICAgICAgcm91dGVOYW1lcy5pbmNsdWRlcyhyb3V0ZS5uYW1lKVxuICAgICAgKTtcblxuICAgICAgaWYgKHJvdXRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc3QgaW5pdGlhbFJvdXRlTmFtZSA9XG4gICAgICAgICAgb3B0aW9ucy5pbml0aWFsUm91dGVOYW1lICE9PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICByb3V0ZU5hbWVzLmluY2x1ZGVzKG9wdGlvbnMuaW5pdGlhbFJvdXRlTmFtZSlcbiAgICAgICAgICAgID8gb3B0aW9ucy5pbml0aWFsUm91dGVOYW1lXG4gICAgICAgICAgICA6IHJvdXRlTmFtZXNbMF07XG5cbiAgICAgICAgcm91dGVzLnB1c2goe1xuICAgICAgICAgIGtleTogYCR7aW5pdGlhbFJvdXRlTmFtZX0tJHtuYW5vaWQoKX1gLFxuICAgICAgICAgIG5hbWU6IGluaXRpYWxSb3V0ZU5hbWUsXG4gICAgICAgICAgcGFyYW1zOiByb3V0ZVBhcmFtTGlzdFtpbml0aWFsUm91dGVOYW1lXSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICByb3V0ZXMsXG4gICAgICAgIGluZGV4OiBNYXRoLm1pbihzdGF0ZS5pbmRleCwgcm91dGVzLmxlbmd0aCAtIDEpLFxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgZ2V0U3RhdGVGb3JSb3V0ZUZvY3VzKHN0YXRlLCBrZXkpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gc3RhdGUucm91dGVzLmZpbmRJbmRleCgocikgPT4gci5rZXkgPT09IGtleSk7XG5cbiAgICAgIGlmIChpbmRleCA9PT0gLTEgfHwgaW5kZXggPT09IHN0YXRlLmluZGV4KSB7XG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIGluZGV4LFxuICAgICAgICByb3V0ZXM6IHN0YXRlLnJvdXRlcy5zbGljZSgwLCBpbmRleCArIDEpLFxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgZ2V0U3RhdGVGb3JBY3Rpb24oc3RhdGUsIGFjdGlvbiwgb3B0aW9ucykge1xuICAgICAgY29uc3QgeyByb3V0ZVBhcmFtTGlzdCB9ID0gb3B0aW9ucztcblxuICAgICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgICBjYXNlICdSRVBMQUNFJzoge1xuICAgICAgICAgIGNvbnN0IGluZGV4ID1cbiAgICAgICAgICAgIGFjdGlvbi50YXJnZXQgPT09IHN0YXRlLmtleSAmJiBhY3Rpb24uc291cmNlXG4gICAgICAgICAgICAgID8gc3RhdGUucm91dGVzLmZpbmRJbmRleCgocikgPT4gci5rZXkgPT09IGFjdGlvbi5zb3VyY2UpXG4gICAgICAgICAgICAgIDogc3RhdGUuaW5kZXg7XG5cbiAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB7IG5hbWUsIGtleSwgcGFyYW1zIH0gPSBhY3Rpb24ucGF5bG9hZDtcblxuICAgICAgICAgIGlmICghc3RhdGUucm91dGVOYW1lcy5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgcm91dGVzOiBzdGF0ZS5yb3V0ZXMubWFwKChyb3V0ZSwgaSkgPT5cbiAgICAgICAgICAgICAgaSA9PT0gaW5kZXhcbiAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAga2V5OiBrZXkgIT09IHVuZGVmaW5lZCA/IGtleSA6IGAke25hbWV9LSR7bmFub2lkKCl9YCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOlxuICAgICAgICAgICAgICAgICAgICAgIHJvdXRlUGFyYW1MaXN0W25hbWVdICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnJvdXRlUGFyYW1MaXN0W25hbWVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgOiByb3V0ZVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY2FzZSAnUFVTSCc6XG4gICAgICAgICAgaWYgKHN0YXRlLnJvdXRlTmFtZXMuaW5jbHVkZXMoYWN0aW9uLnBheWxvYWQubmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGdldElkID0gb3B0aW9ucy5yb3V0ZUdldElkTGlzdFthY3Rpb24ucGF5bG9hZC5uYW1lXTtcbiAgICAgICAgICAgIGNvbnN0IGlkID0gZ2V0SWQ/Lih7IHBhcmFtczogYWN0aW9uLnBheWxvYWQucGFyYW1zIH0pO1xuXG4gICAgICAgICAgICBjb25zdCByb3V0ZSA9XG4gICAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkLm5hbWUgJiYgYWN0aW9uLnBheWxvYWQua2V5XG4gICAgICAgICAgICAgICAgPyBzdGF0ZS5yb3V0ZXMuZmluZChcbiAgICAgICAgICAgICAgICAgICAgKHJvdXRlKSA9PlxuICAgICAgICAgICAgICAgICAgICAgIHJvdXRlLm5hbWUgPT09IGFjdGlvbi5wYXlsb2FkLm5hbWUgJiZcbiAgICAgICAgICAgICAgICAgICAgICByb3V0ZS5rZXkgPT09IGFjdGlvbi5wYXlsb2FkLmtleVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIDogaWRcbiAgICAgICAgICAgICAgICA/IHN0YXRlLnJvdXRlcy5maW5kKFxuICAgICAgICAgICAgICAgICAgICAocm91dGUpID0+IGlkID09PSBnZXRJZD8uKHsgcGFyYW1zOiByb3V0ZS5wYXJhbXMgfSlcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZDtcblxuICAgICAgICAgICAgbGV0IHJvdXRlczogUm91dGU8c3RyaW5nPltdO1xuXG4gICAgICAgICAgICBpZiAocm91dGUpIHtcbiAgICAgICAgICAgICAgcm91dGVzID0gc3RhdGUucm91dGVzLmZpbHRlcigocikgPT4gci5rZXkgIT09IHJvdXRlLmtleSk7XG4gICAgICAgICAgICAgIHJvdXRlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAuLi5yb3V0ZSxcbiAgICAgICAgICAgICAgICBwYXJhbXM6XG4gICAgICAgICAgICAgICAgICBhY3Rpb24ucGF5bG9hZC5wYXJhbXMgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnJvdXRlLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmFjdGlvbi5wYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDogcm91dGUucGFyYW1zLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJvdXRlcyA9IFtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5yb3V0ZXMsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAga2V5OlxuICAgICAgICAgICAgICAgICAgICBhY3Rpb24ucGF5bG9hZC5rZXkgPz8gYCR7YWN0aW9uLnBheWxvYWQubmFtZX0tJHtuYW5vaWQoKX1gLFxuICAgICAgICAgICAgICAgICAgbmFtZTogYWN0aW9uLnBheWxvYWQubmFtZSxcbiAgICAgICAgICAgICAgICAgIHBhcmFtczpcbiAgICAgICAgICAgICAgICAgICAgcm91dGVQYXJhbUxpc3RbYWN0aW9uLnBheWxvYWQubmFtZV0gIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5yb3V0ZVBhcmFtTGlzdFthY3Rpb24ucGF5bG9hZC5uYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uYWN0aW9uLnBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIDogYWN0aW9uLnBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICBpbmRleDogcm91dGVzLmxlbmd0aCAtIDEsXG4gICAgICAgICAgICAgIHJvdXRlcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgY2FzZSAnUE9QJzoge1xuICAgICAgICAgIGNvbnN0IGluZGV4ID1cbiAgICAgICAgICAgIGFjdGlvbi50YXJnZXQgPT09IHN0YXRlLmtleSAmJiBhY3Rpb24uc291cmNlXG4gICAgICAgICAgICAgID8gc3RhdGUucm91dGVzLmZpbmRJbmRleCgocikgPT4gci5rZXkgPT09IGFjdGlvbi5zb3VyY2UpXG4gICAgICAgICAgICAgIDogc3RhdGUuaW5kZXg7XG5cbiAgICAgICAgICBpZiAoaW5kZXggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBjb3VudCA9IE1hdGgubWF4KGluZGV4IC0gYWN0aW9uLnBheWxvYWQuY291bnQgKyAxLCAxKTtcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlcyA9IHN0YXRlLnJvdXRlc1xuICAgICAgICAgICAgICAuc2xpY2UoMCwgY291bnQpXG4gICAgICAgICAgICAgIC5jb25jYXQoc3RhdGUucm91dGVzLnNsaWNlKGluZGV4ICsgMSkpO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi5zdGF0ZSxcbiAgICAgICAgICAgICAgaW5kZXg6IHJvdXRlcy5sZW5ndGggLSAxLFxuICAgICAgICAgICAgICByb3V0ZXMsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgY2FzZSAnUE9QX1RPX1RPUCc6XG4gICAgICAgICAgcmV0dXJuIHJvdXRlci5nZXRTdGF0ZUZvckFjdGlvbihcbiAgICAgICAgICAgIHN0YXRlLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiAnUE9QJyxcbiAgICAgICAgICAgICAgcGF5bG9hZDogeyBjb3VudDogc3RhdGUucm91dGVzLmxlbmd0aCAtIDEgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgKTtcblxuICAgICAgICBjYXNlICdOQVZJR0FURSc6XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgYWN0aW9uLnBheWxvYWQua2V5IHx8XG4gICAgICAgICAgICAoYWN0aW9uLnBheWxvYWQubmFtZSAmJlxuICAgICAgICAgICAgICBzdGF0ZS5yb3V0ZU5hbWVzLmluY2x1ZGVzKGFjdGlvbi5wYXlsb2FkLm5hbWUpKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgLy8gSWYgdGhlIHJvdXRlIGFscmVhZHkgZXhpc3RzLCBuYXZpZ2F0ZSB0byB0aGF0XG4gICAgICAgICAgICBsZXQgaW5kZXggPSAtMTtcblxuICAgICAgICAgICAgY29uc3QgZ2V0SWQgPVxuICAgICAgICAgICAgICAvLyBgZ2V0SWRgIGFuZCBga2V5YCBjYW4ndCBiZSB1c2VkIHRvZ2V0aGVyXG4gICAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkLmtleSA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkLm5hbWUgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgID8gb3B0aW9ucy5yb3V0ZUdldElkTGlzdFthY3Rpb24ucGF5bG9hZC5uYW1lXVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgY29uc3QgaWQgPSBnZXRJZD8uKHsgcGFyYW1zOiBhY3Rpb24ucGF5bG9hZC5wYXJhbXMgfSk7XG5cbiAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICBpbmRleCA9IHN0YXRlLnJvdXRlcy5maW5kSW5kZXgoXG4gICAgICAgICAgICAgICAgKHJvdXRlKSA9PiBpZCA9PT0gZ2V0SWQ/Lih7IHBhcmFtczogcm91dGUucGFyYW1zIH0pXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICAoc3RhdGUucm91dGVzW3N0YXRlLmluZGV4XS5uYW1lID09PSBhY3Rpb24ucGF5bG9hZC5uYW1lICYmXG4gICAgICAgICAgICAgICAgYWN0aW9uLnBheWxvYWQua2V5ID09PSB1bmRlZmluZWQpIHx8XG4gICAgICAgICAgICAgIHN0YXRlLnJvdXRlc1tzdGF0ZS5pbmRleF0ua2V5ID09PSBhY3Rpb24ucGF5bG9hZC5rZXlcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICBpbmRleCA9IHN0YXRlLmluZGV4O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXRlLnJvdXRlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgIChzdGF0ZS5yb3V0ZXNbaV0ubmFtZSA9PT0gYWN0aW9uLnBheWxvYWQubmFtZSAmJlxuICAgICAgICAgICAgICAgICAgICBhY3Rpb24ucGF5bG9hZC5rZXkgPT09IHVuZGVmaW5lZCkgfHxcbiAgICAgICAgICAgICAgICAgIHN0YXRlLnJvdXRlc1tpXS5rZXkgPT09IGFjdGlvbi5wYXlsb2FkLmtleVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgaW5kZXggPSBpO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgaW5kZXggPT09IC0xICYmXG4gICAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkLmtleSAmJlxuICAgICAgICAgICAgICBhY3Rpb24ucGF5bG9hZC5uYW1lID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSAmJiBhY3Rpb24ucGF5bG9hZC5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgY29uc3Qgcm91dGVzID0gW1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLnJvdXRlcyxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBrZXk6XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkLmtleSA/PyBgJHthY3Rpb24ucGF5bG9hZC5uYW1lfS0ke25hbm9pZCgpfWAsXG4gICAgICAgICAgICAgICAgICBuYW1lOiBhY3Rpb24ucGF5bG9hZC5uYW1lLFxuICAgICAgICAgICAgICAgICAgcGFyYW1zOlxuICAgICAgICAgICAgICAgICAgICByb3V0ZVBhcmFtTGlzdFthY3Rpb24ucGF5bG9hZC5uYW1lXSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnJvdXRlUGFyYW1MaXN0W2FjdGlvbi5wYXlsb2FkLm5hbWVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5hY3Rpb24ucGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgOiBhY3Rpb24ucGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICAgIHJvdXRlcyxcbiAgICAgICAgICAgICAgICBpbmRleDogcm91dGVzLmxlbmd0aCAtIDEsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gc3RhdGUucm91dGVzW2luZGV4XTtcblxuICAgICAgICAgICAgbGV0IHBhcmFtcztcblxuICAgICAgICAgICAgaWYgKGFjdGlvbi5wYXlsb2FkLm1lcmdlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICBwYXJhbXMgPVxuICAgICAgICAgICAgICAgIHJvdXRlUGFyYW1MaXN0W3JvdXRlLm5hbWVdICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgIC4uLnJvdXRlUGFyYW1MaXN0W3JvdXRlLm5hbWVdLFxuICAgICAgICAgICAgICAgICAgICAgIC4uLmFjdGlvbi5wYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgOiBhY3Rpb24ucGF5bG9hZC5wYXJhbXM7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwYXJhbXMgPSBhY3Rpb24ucGF5bG9hZC5wYXJhbXNcbiAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucm91dGUucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICAuLi5hY3Rpb24ucGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgOiByb3V0ZS5wYXJhbXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgcm91dGVzOiBbXG4gICAgICAgICAgICAgICAgLi4uc3RhdGUucm91dGVzLnNsaWNlKDAsIGluZGV4KSxcbiAgICAgICAgICAgICAgICBwYXJhbXMgIT09IHJvdXRlLnBhcmFtc1xuICAgICAgICAgICAgICAgICAgPyB7IC4uLnJvdXRlLCBwYXJhbXMgfVxuICAgICAgICAgICAgICAgICAgOiBzdGF0ZS5yb3V0ZXNbaW5kZXhdLFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICBjYXNlICdHT19CQUNLJzpcbiAgICAgICAgICBpZiAoc3RhdGUuaW5kZXggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcm91dGVyLmdldFN0YXRlRm9yQWN0aW9uKFxuICAgICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1AnLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsgY291bnQ6IDEgfSxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IGFjdGlvbi50YXJnZXQsXG4gICAgICAgICAgICAgICAgc291cmNlOiBhY3Rpb24uc291cmNlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIEJhc2VSb3V0ZXIuZ2V0U3RhdGVGb3JBY3Rpb24oc3RhdGUsIGFjdGlvbik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGFjdGlvbkNyZWF0b3JzOiBTdGFja0FjdGlvbnMsXG4gIH07XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cbiJdfQ==