8f3dd1c672e5309efe3a83a74c60ca35
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _ScrollViewCommands = _interopRequireDefault(require("./ScrollView/ScrollViewCommands"));

var React = require('react');

var Dimensions = require("../Utilities/Dimensions");

var FrameRateLogger = require("../Interaction/FrameRateLogger");

var Keyboard = require("./Keyboard/Keyboard");

var ReactNative = require("../Renderer/shims/ReactNative");

var TextInputState = require("./TextInput/TextInputState");

var UIManager = require("../ReactNative/UIManager");

var Platform = require("../Utilities/Platform");

var invariant = require('invariant');

var performanceNow = require('fbjs/lib/performanceNow');

var IS_ANIMATING_TOUCH_START_THRESHOLD_MS = 16;
var ScrollResponderMixin = {
  _subscriptionKeyboardWillShow: null,
  _subscriptionKeyboardWillHide: null,
  _subscriptionKeyboardDidShow: null,
  _subscriptionKeyboardDidHide: null,
  scrollResponderMixinGetInitialState: function scrollResponderMixinGetInitialState() {
    return {
      isTouching: false,
      lastMomentumScrollBeginTime: 0,
      lastMomentumScrollEndTime: 0,
      observedScrollSinceBecomingResponder: false,
      becameResponderWhileAnimating: false
    };
  },
  scrollResponderHandleScrollShouldSetResponder: function scrollResponderHandleScrollShouldSetResponder() {
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    return this.state.isTouching;
  },
  scrollResponderHandleStartShouldSetResponder: function scrollResponderHandleStartShouldSetResponder(e) {
    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    var currentlyFocusedInput = TextInputState.currentlyFocusedInput();

    if (this.props.keyboardShouldPersistTaps === 'handled' && currentlyFocusedInput != null && e.target !== currentlyFocusedInput) {
      return true;
    }

    return false;
  },
  scrollResponderHandleStartShouldSetResponderCapture: function scrollResponderHandleStartShouldSetResponderCapture(e) {
    if (this.scrollResponderIsAnimating()) {
      return true;
    }

    if (this.props.disableScrollViewPanResponder === true) {
      return false;
    }

    var currentlyFocusedTextInput = TextInputState.currentlyFocusedInput();
    var keyboardShouldPersistTaps = this.props.keyboardShouldPersistTaps;
    var keyboardNeverPersistTaps = !keyboardShouldPersistTaps || keyboardShouldPersistTaps === 'never';

    if (typeof e.target === 'number') {
      if (__DEV__) {
        console.error('Did not expect event target to be a number. Should have been a native component');
      }

      return false;
    }

    if (keyboardNeverPersistTaps && currentlyFocusedTextInput != null && e.target != null && !TextInputState.isTextInput(e.target)) {
      return true;
    }

    return false;
  },
  scrollResponderHandleResponderReject: function scrollResponderHandleResponderReject() {},
  scrollResponderHandleTerminationRequest: function scrollResponderHandleTerminationRequest() {
    return !this.state.observedScrollSinceBecomingResponder;
  },
  scrollResponderHandleTouchEnd: function scrollResponderHandleTouchEnd(e) {
    var nativeEvent = e.nativeEvent;
    this.state.isTouching = nativeEvent.touches.length !== 0;
    this.props.onTouchEnd && this.props.onTouchEnd(e);
  },
  scrollResponderHandleTouchCancel: function scrollResponderHandleTouchCancel(e) {
    this.state.isTouching = false;
    this.props.onTouchCancel && this.props.onTouchCancel(e);
  },
  scrollResponderHandleResponderRelease: function scrollResponderHandleResponderRelease(e) {
    this.props.onResponderRelease && this.props.onResponderRelease(e);

    if (typeof e.target === 'number') {
      if (__DEV__) {
        console.error('Did not expect event target to be a number. Should have been a native component');
      }

      return;
    }

    var currentlyFocusedTextInput = TextInputState.currentlyFocusedInput();

    if (this.props.keyboardShouldPersistTaps !== true && this.props.keyboardShouldPersistTaps !== 'always' && currentlyFocusedTextInput != null && e.target !== currentlyFocusedTextInput && !this.state.observedScrollSinceBecomingResponder && !this.state.becameResponderWhileAnimating) {
      this.props.onScrollResponderKeyboardDismissed && this.props.onScrollResponderKeyboardDismissed(e);
      TextInputState.blurTextInput(currentlyFocusedTextInput);
    }
  },
  scrollResponderHandleScroll: function scrollResponderHandleScroll(e) {
    this.state.observedScrollSinceBecomingResponder = true;
    this.props.onScroll && this.props.onScroll(e);
  },
  scrollResponderHandleResponderGrant: function scrollResponderHandleResponderGrant(e) {
    this.state.observedScrollSinceBecomingResponder = false;
    this.props.onResponderGrant && this.props.onResponderGrant(e);
    this.state.becameResponderWhileAnimating = this.scrollResponderIsAnimating();
  },
  scrollResponderHandleScrollBeginDrag: function scrollResponderHandleScrollBeginDrag(e) {
    FrameRateLogger.beginScroll();
    this.props.onScrollBeginDrag && this.props.onScrollBeginDrag(e);
  },
  scrollResponderHandleScrollEndDrag: function scrollResponderHandleScrollEndDrag(e) {
    var velocity = e.nativeEvent.velocity;

    if (!this.scrollResponderIsAnimating() && (!velocity || velocity.x === 0 && velocity.y === 0)) {
      FrameRateLogger.endScroll();
    }

    this.props.onScrollEndDrag && this.props.onScrollEndDrag(e);
  },
  scrollResponderHandleMomentumScrollBegin: function scrollResponderHandleMomentumScrollBegin(e) {
    this.state.lastMomentumScrollBeginTime = performanceNow();
    this.props.onMomentumScrollBegin && this.props.onMomentumScrollBegin(e);
  },
  scrollResponderHandleMomentumScrollEnd: function scrollResponderHandleMomentumScrollEnd(e) {
    FrameRateLogger.endScroll();
    this.state.lastMomentumScrollEndTime = performanceNow();
    this.props.onMomentumScrollEnd && this.props.onMomentumScrollEnd(e);
  },
  scrollResponderHandleTouchStart: function scrollResponderHandleTouchStart(e) {
    this.state.isTouching = true;
    this.props.onTouchStart && this.props.onTouchStart(e);
  },
  scrollResponderHandleTouchMove: function scrollResponderHandleTouchMove(e) {
    this.props.onTouchMove && this.props.onTouchMove(e);
  },
  scrollResponderIsAnimating: function scrollResponderIsAnimating() {
    var now = performanceNow();
    var timeSinceLastMomentumScrollEnd = now - this.state.lastMomentumScrollEndTime;
    var isAnimating = timeSinceLastMomentumScrollEnd < IS_ANIMATING_TOUCH_START_THRESHOLD_MS || this.state.lastMomentumScrollEndTime < this.state.lastMomentumScrollBeginTime;
    return isAnimating;
  },
  scrollResponderGetScrollableNode: function scrollResponderGetScrollableNode() {
    return this.getScrollableNode ? this.getScrollableNode() : ReactNative.findNodeHandle(this);
  },
  scrollResponderScrollTo: function scrollResponderScrollTo(x, y, animated) {
    if (typeof x === 'number') {
      console.warn('`scrollResponderScrollTo(x, y, animated)` is deprecated. Use `scrollResponderScrollTo({x: 5, y: 5, animated: true})` instead.');
    } else {
      var _ref = x || {};

      x = _ref.x;
      y = _ref.y;
      animated = _ref.animated;
    }

    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected scrollTo to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.scrollTo(nativeScrollRef, x || 0, y || 0, animated !== false);
  },
  scrollResponderScrollToEnd: function scrollResponderScrollToEnd(options) {
    var animated = (options && options.animated) !== false;
    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected scrollToEnd to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.scrollToEnd(nativeScrollRef, animated);
  },
  scrollResponderZoomTo: function scrollResponderZoomTo(rect, animated) {
    invariant(Platform.OS === 'ios', 'zoomToRect is not implemented');

    if ('animated' in rect) {
      animated = rect.animated;
      delete rect.animated;
    } else if (typeof animated !== 'undefined') {
      console.warn('`scrollResponderZoomTo` `animated` argument is deprecated. Use `options.animated` instead');
    }

    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected zoomToRect to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.zoomToRect(nativeScrollRef, rect, animated !== false);
  },
  scrollResponderFlashScrollIndicators: function scrollResponderFlashScrollIndicators() {
    var that = this;
    invariant(that.getNativeScrollRef != null, 'Expected flashScrollIndicators to be called on a scrollViewRef. If this exception occurs it is likely a bug in React Native');
    var nativeScrollRef = that.getNativeScrollRef();

    if (nativeScrollRef == null) {
      return;
    }

    _ScrollViewCommands.default.flashScrollIndicators(nativeScrollRef);
  },
  scrollResponderScrollNativeHandleToKeyboard: function scrollResponderScrollNativeHandleToKeyboard(nodeHandle, additionalOffset, preventNegativeScrollOffset) {
    this.additionalScrollOffset = additionalOffset || 0;
    this.preventNegativeScrollOffset = !!preventNegativeScrollOffset;

    if (typeof nodeHandle === 'number') {
      UIManager.measureLayout(nodeHandle, ReactNative.findNodeHandle(this.getInnerViewNode()), this.scrollResponderTextInputFocusError, this.scrollResponderInputMeasureAndScrollToKeyboard);
    } else {
      var innerRef = this.getInnerViewRef();

      if (innerRef == null) {
        return;
      }

      nodeHandle.measureLayout(innerRef, this.scrollResponderInputMeasureAndScrollToKeyboard, this.scrollResponderTextInputFocusError);
    }
  },
  scrollResponderInputMeasureAndScrollToKeyboard: function scrollResponderInputMeasureAndScrollToKeyboard(left, top, width, height) {
    var keyboardScreenY = Dimensions.get('window').height;

    if (this.keyboardWillOpenTo) {
      keyboardScreenY = this.keyboardWillOpenTo.endCoordinates.screenY;
    }

    var scrollOffsetY = top - keyboardScreenY + height + this.additionalScrollOffset;

    if (this.preventNegativeScrollOffset) {
      scrollOffsetY = Math.max(0, scrollOffsetY);
    }

    this.scrollResponderScrollTo({
      x: 0,
      y: scrollOffsetY,
      animated: true
    });
    this.additionalOffset = 0;
    this.preventNegativeScrollOffset = false;
  },
  scrollResponderTextInputFocusError: function scrollResponderTextInputFocusError(msg) {
    console.error('Error measuring text field: ', msg);
  },
  UNSAFE_componentWillMount: function UNSAFE_componentWillMount() {
    var _ref2 = this.props,
        keyboardShouldPersistTaps = _ref2.keyboardShouldPersistTaps;

    if (typeof keyboardShouldPersistTaps === 'boolean') {
      console.warn("'keyboardShouldPersistTaps={" + (keyboardShouldPersistTaps === true ? 'true' : 'false') + "}' is deprecated. " + ("Use 'keyboardShouldPersistTaps=\"" + (keyboardShouldPersistTaps ? 'always' : 'never') + "\"' instead"));
    }

    this.keyboardWillOpenTo = null;
    this.additionalScrollOffset = 0;
    this._subscriptionKeyboardWillShow = Keyboard.addListener('keyboardWillShow', this.scrollResponderKeyboardWillShow);
    this._subscriptionKeyboardWillHide = Keyboard.addListener('keyboardWillHide', this.scrollResponderKeyboardWillHide);
    this._subscriptionKeyboardDidShow = Keyboard.addListener('keyboardDidShow', this.scrollResponderKeyboardDidShow);
    this._subscriptionKeyboardDidHide = Keyboard.addListener('keyboardDidHide', this.scrollResponderKeyboardDidHide);
  },
  componentWillUnmount: function componentWillUnmount() {
    if (this._subscriptionKeyboardWillShow != null) {
      this._subscriptionKeyboardWillShow.remove();
    }

    if (this._subscriptionKeyboardWillHide != null) {
      this._subscriptionKeyboardWillHide.remove();
    }

    if (this._subscriptionKeyboardDidShow != null) {
      this._subscriptionKeyboardDidShow.remove();
    }

    if (this._subscriptionKeyboardDidHide != null) {
      this._subscriptionKeyboardDidHide.remove();
    }
  },
  scrollResponderKeyboardWillShow: function scrollResponderKeyboardWillShow(e) {
    this.keyboardWillOpenTo = e;
    this.props.onKeyboardWillShow && this.props.onKeyboardWillShow(e);
  },
  scrollResponderKeyboardWillHide: function scrollResponderKeyboardWillHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardWillHide && this.props.onKeyboardWillHide(e);
  },
  scrollResponderKeyboardDidShow: function scrollResponderKeyboardDidShow(e) {
    if (e) {
      this.keyboardWillOpenTo = e;
    }

    this.props.onKeyboardDidShow && this.props.onKeyboardDidShow(e);
  },
  scrollResponderKeyboardDidHide: function scrollResponderKeyboardDidHide(e) {
    this.keyboardWillOpenTo = null;
    this.props.onKeyboardDidHide && this.props.onKeyboardDidHide(e);
  }
};
var ScrollResponder = {
  Mixin: ScrollResponderMixin
};
module.exports = ScrollResponder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNjcm9sbFJlc3BvbmRlci5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsInJlcXVpcmUiLCJEaW1lbnNpb25zIiwiRnJhbWVSYXRlTG9nZ2VyIiwiS2V5Ym9hcmQiLCJSZWFjdE5hdGl2ZSIsIlRleHRJbnB1dFN0YXRlIiwiVUlNYW5hZ2VyIiwiUGxhdGZvcm0iLCJpbnZhcmlhbnQiLCJwZXJmb3JtYW5jZU5vdyIsIklTX0FOSU1BVElOR19UT1VDSF9TVEFSVF9USFJFU0hPTERfTVMiLCJTY3JvbGxSZXNwb25kZXJNaXhpbiIsIl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93IiwiX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUiLCJfc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRTaG93IiwiX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZSIsInNjcm9sbFJlc3BvbmRlck1peGluR2V0SW5pdGlhbFN0YXRlIiwiaXNUb3VjaGluZyIsImxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSIsImxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUiLCJvYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIiLCJiZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbFNob3VsZFNldFJlc3BvbmRlciIsInByb3BzIiwiZGlzYWJsZVNjcm9sbFZpZXdQYW5SZXNwb25kZXIiLCJzdGF0ZSIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyIiwiZSIsImN1cnJlbnRseUZvY3VzZWRJbnB1dCIsImtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMiLCJ0YXJnZXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUiLCJzY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZyIsImN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQiLCJrZXlib2FyZE5ldmVyUGVyc2lzdFRhcHMiLCJfX0RFVl9fIiwiY29uc29sZSIsImVycm9yIiwiaXNUZXh0SW5wdXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWplY3QiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUZXJtaW5hdGlvblJlcXVlc3QiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaEVuZCIsIm5hdGl2ZUV2ZW50IiwidG91Y2hlcyIsImxlbmd0aCIsIm9uVG91Y2hFbmQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaENhbmNlbCIsIm9uVG91Y2hDYW5jZWwiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWxlYXNlIiwib25SZXNwb25kZXJSZWxlYXNlIiwib25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZCIsImJsdXJUZXh0SW5wdXQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGwiLCJvblNjcm9sbCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlckdyYW50Iiwib25SZXNwb25kZXJHcmFudCIsInNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbEJlZ2luRHJhZyIsImJlZ2luU2Nyb2xsIiwib25TY3JvbGxCZWdpbkRyYWciLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxFbmREcmFnIiwidmVsb2NpdHkiLCJ4IiwieSIsImVuZFNjcm9sbCIsIm9uU2Nyb2xsRW5kRHJhZyIsInNjcm9sbFJlc3BvbmRlckhhbmRsZU1vbWVudHVtU2Nyb2xsQmVnaW4iLCJvbk1vbWVudHVtU2Nyb2xsQmVnaW4iLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVNb21lbnR1bVNjcm9sbEVuZCIsIm9uTW9tZW50dW1TY3JvbGxFbmQiLCJzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaFN0YXJ0Iiwib25Ub3VjaFN0YXJ0Iiwic2Nyb2xsUmVzcG9uZGVySGFuZGxlVG91Y2hNb3ZlIiwib25Ub3VjaE1vdmUiLCJub3ciLCJ0aW1lU2luY2VMYXN0TW9tZW50dW1TY3JvbGxFbmQiLCJpc0FuaW1hdGluZyIsInNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlIiwiZ2V0U2Nyb2xsYWJsZU5vZGUiLCJmaW5kTm9kZUhhbmRsZSIsInNjcm9sbFJlc3BvbmRlclNjcm9sbFRvIiwiYW5pbWF0ZWQiLCJ3YXJuIiwidGhhdCIsImdldE5hdGl2ZVNjcm9sbFJlZiIsIm5hdGl2ZVNjcm9sbFJlZiIsIkNvbW1hbmRzIiwic2Nyb2xsVG8iLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZCIsIm9wdGlvbnMiLCJzY3JvbGxUb0VuZCIsInNjcm9sbFJlc3BvbmRlclpvb21UbyIsInJlY3QiLCJPUyIsInpvb21Ub1JlY3QiLCJzY3JvbGxSZXNwb25kZXJGbGFzaFNjcm9sbEluZGljYXRvcnMiLCJmbGFzaFNjcm9sbEluZGljYXRvcnMiLCJzY3JvbGxSZXNwb25kZXJTY3JvbGxOYXRpdmVIYW5kbGVUb0tleWJvYXJkIiwibm9kZUhhbmRsZSIsImFkZGl0aW9uYWxPZmZzZXQiLCJwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQiLCJhZGRpdGlvbmFsU2Nyb2xsT2Zmc2V0IiwibWVhc3VyZUxheW91dCIsImdldElubmVyVmlld05vZGUiLCJzY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yIiwic2Nyb2xsUmVzcG9uZGVySW5wdXRNZWFzdXJlQW5kU2Nyb2xsVG9LZXlib2FyZCIsImlubmVyUmVmIiwiZ2V0SW5uZXJWaWV3UmVmIiwibGVmdCIsInRvcCIsIndpZHRoIiwiaGVpZ2h0Iiwia2V5Ym9hcmRTY3JlZW5ZIiwiZ2V0Iiwia2V5Ym9hcmRXaWxsT3BlblRvIiwiZW5kQ29vcmRpbmF0ZXMiLCJzY3JlZW5ZIiwic2Nyb2xsT2Zmc2V0WSIsIk1hdGgiLCJtYXgiLCJtc2ciLCJVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50IiwiYWRkTGlzdGVuZXIiLCJzY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxTaG93Iiwic2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsSGlkZSIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkU2hvdyIsInNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkSGlkZSIsImNvbXBvbmVudFdpbGxVbm1vdW50IiwicmVtb3ZlIiwib25LZXlib2FyZFdpbGxTaG93Iiwib25LZXlib2FyZFdpbGxIaWRlIiwib25LZXlib2FyZERpZFNob3ciLCJvbktleWJvYXJkRGlkSGlkZSIsIlNjcm9sbFJlc3BvbmRlciIsIk1peGluIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7QUFVQTs7QUFSQSxJQUFNQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxPQUFELENBQXJCOztBQUNBLElBQU1DLFVBQVUsR0FBR0QsT0FBTywyQkFBMUI7O0FBQ0EsSUFBTUUsZUFBZSxHQUFHRixPQUFPLGtDQUEvQjs7QUFDQSxJQUFNRyxRQUFRLEdBQUdILE9BQU8sdUJBQXhCOztBQUNBLElBQU1JLFdBQVcsR0FBR0osT0FBTyxpQ0FBM0I7O0FBQ0EsSUFBTUssY0FBYyxHQUFHTCxPQUFPLDhCQUE5Qjs7QUFDQSxJQUFNTSxTQUFTLEdBQUdOLE9BQU8sNEJBQXpCOztBQUNBLElBQU1PLFFBQVEsR0FBR1AsT0FBTyx5QkFBeEI7O0FBR0EsSUFBTVEsU0FBUyxHQUFHUixPQUFPLENBQUMsV0FBRCxDQUF6Qjs7QUFDQSxJQUFNUyxjQUFjLEdBQUdULE9BQU8sQ0FBQyx5QkFBRCxDQUE5Qjs7QUF1RkEsSUFBTVUscUNBQXFDLEdBQUcsRUFBOUM7QUFVQSxJQUFNQyxvQkFBb0IsR0FBRztBQUMzQkMsRUFBQUEsNkJBQTZCLEVBQUcsSUFETDtBQUUzQkMsRUFBQUEsNkJBQTZCLEVBQUcsSUFGTDtBQUczQkMsRUFBQUEsNEJBQTRCLEVBQUcsSUFISjtBQUkzQkMsRUFBQUEsNEJBQTRCLEVBQUcsSUFKSjtBQUszQkMsRUFBQUEsbUNBQW1DLEVBQUUsK0NBQWtCO0FBQ3JELFdBQU87QUFDTEMsTUFBQUEsVUFBVSxFQUFFLEtBRFA7QUFFTEMsTUFBQUEsMkJBQTJCLEVBQUUsQ0FGeEI7QUFH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RCxRQUFJQSxDQUFKLEVBQU87QUFDTCxXQUFLc0Ysa0JBQUwsR0FBMEJ0RixDQUExQjtBQUNEOztBQUNELFNBQUtKLEtBQUwsQ0FBVzJHLGlCQUFYLElBQWdDLEtBQUszRyxLQUFMLENBQVcyRyxpQkFBWCxDQUE2QnZHLENBQTdCLENBQWhDO0FBQ0QsR0Fob0IwQjtBQWtvQjNCa0csRUFBQUEsOEJBQThCLEVBQUUsd0NBQVNsRyxDQUFULEVBQTJCO0FBQ3pELFNBQUtzRixrQkFBTCxHQUEwQixJQUExQjtBQUNBLFNBQUsxRixLQUFMLENBQVc0RyxpQkFBWCxJQUFnQyxLQUFLNUcsS0FBTCxDQUFXNEcsaUJBQVgsQ0FBNkJ4RyxDQUE3QixDQUFoQztBQUNEO0FBcm9CMEIsQ0FBN0I7QUF3b0JBLElBQU15RyxlQUFlLEdBQUc7QUFDdEJDLEVBQUFBLEtBQUssRUFBRTFIO0FBRGUsQ0FBeEI7QUFJQTJILE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQkgsZUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmb3JtYXRcbiAqIEBmbG93XG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCBEaW1lbnNpb25zID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL0RpbWVuc2lvbnMnKTtcbmNvbnN0IEZyYW1lUmF0ZUxvZ2dlciA9IHJlcXVpcmUoJy4uL0ludGVyYWN0aW9uL0ZyYW1lUmF0ZUxvZ2dlcicpO1xuY29uc3QgS2V5Ym9hcmQgPSByZXF1aXJlKCcuL0tleWJvYXJkL0tleWJvYXJkJyk7XG5jb25zdCBSZWFjdE5hdGl2ZSA9IHJlcXVpcmUoJy4uL1JlbmRlcmVyL3NoaW1zL1JlYWN0TmF0aXZlJyk7XG5jb25zdCBUZXh0SW5wdXRTdGF0ZSA9IHJlcXVpcmUoJy4vVGV4dElucHV0L1RleHRJbnB1dFN0YXRlJyk7XG5jb25zdCBVSU1hbmFnZXIgPSByZXF1aXJlKCcuLi9SZWFjdE5hdGl2ZS9VSU1hbmFnZXInKTtcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL1BsYXRmb3JtJyk7XG5pbXBvcnQgQ29tbWFuZHMgZnJvbSAnLi9TY3JvbGxWaWV3L1Njcm9sbFZpZXdDb21tYW5kcyc7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuY29uc3QgcGVyZm9ybWFuY2VOb3cgPSByZXF1aXJlKCdmYmpzL2xpYi9wZXJmb3JtYW5jZU5vdycpO1xuXG5pbXBvcnQgdHlwZSB7UHJlc3NFdmVudCwgU2Nyb2xsRXZlbnR9IGZyb20gJy4uL1R5cGVzL0NvcmVFdmVudFR5cGVzJztcbmltcG9ydCB0eXBlb2YgU2Nyb2xsVmlldyBmcm9tICcuL1Njcm9sbFZpZXcvU2Nyb2xsVmlldyc7XG5pbXBvcnQgdHlwZSB7UHJvcHMgYXMgU2Nyb2xsVmlld1Byb3BzfSBmcm9tICcuL1Njcm9sbFZpZXcvU2Nyb2xsVmlldyc7XG5pbXBvcnQgdHlwZSB7S2V5Ym9hcmRFdmVudH0gZnJvbSAnLi9LZXlib2FyZC9LZXlib2FyZCc7XG5pbXBvcnQgdHlwZSBFbWl0dGVyU3Vic2NyaXB0aW9uIGZyb20gJy4uL3ZlbmRvci9lbWl0dGVyL0VtaXR0ZXJTdWJzY3JpcHRpb24nO1xuaW1wb3J0IHR5cGUge0hvc3RDb21wb25lbnR9IGZyb20gJy4uL1JlbmRlcmVyL3NoaW1zL1JlYWN0TmF0aXZlVHlwZXMnO1xuXG4vKipcbiAqIE1peGluIHRoYXQgY2FuIGJlIGludGVncmF0ZWQgaW4gb3JkZXIgdG8gaGFuZGxlIHNjcm9sbGluZyB0aGF0IHBsYXlzIHdlbGxcbiAqIHdpdGggYFJlc3BvbmRlckV2ZW50UGx1Z2luYC4gSW50ZWdyYXRlIHdpdGggeW91ciBwbGF0Zm9ybSBzcGVjaWZpYyBzY3JvbGxcbiAqIHZpZXdzLCBvciBldmVuIHlvdXIgY3VzdG9tIGJ1aWx0IChldmVyeS1mcmFtZSBhbmltYXRpbmcpIHNjcm9sbCB2aWV3cyBzbyB0aGF0XG4gKiBhbGwgb2YgdGhlc2Ugc3lzdGVtcyBwbGF5IHdlbGwgd2l0aCB0aGUgYFJlc3BvbmRlckV2ZW50UGx1Z2luYC5cbiAqXG4gKiBpT1Mgc2Nyb2xsIGV2ZW50IHRpbWluZyBudWFuY2VzOlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICpcbiAqXG4gKiBTY3JvbGxpbmcgd2l0aG91dCBib3VuY2luZywgaWYgeW91IHRvdWNoIGRvd246XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKlxuICogMS4gYG9uTW9tZW50dW1TY3JvbGxCZWdpbmAgKHdoZW4gYW5pbWF0aW9uIGJlZ2lucyBhZnRlciBsZXR0aW5nIHVwKVxuICogICAgLi4uIHBoeXNpY2FsIHRvdWNoIHN0YXJ0cyAuLi5cbiAqIDIuIGBvblRvdWNoU3RhcnRDYXB0dXJlYCAgICh3aGVuIHlvdSBwcmVzcyBkb3duIHRvIHN0b3AgdGhlIHNjcm9sbClcbiAqIDMuIGBvblRvdWNoU3RhcnRgICAgICAgICAgIChzYW1lLCBidXQgYnViYmxlIHBoYXNlKVxuICogNC4gYG9uUmVzcG9uZGVyUmVsZWFzZWAgICAgKHdoZW4gbGlmdGluZyB1cCAtIHlvdSBjb3VsZCBwYXVzZSBmb3JldmVyIGJlZm9yZSAqIGxpZnRpbmcpXG4gKiA1LiBgb25Nb21lbnR1bVNjcm9sbEVuZGBcbiAqXG4gKlxuICogU2Nyb2xsaW5nIHdpdGggYm91bmNpbmcsIGlmIHlvdSB0b3VjaCBkb3duOlxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICpcbiAqIDEuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gICh3aGVuIGFuaW1hdGlvbiBiZWdpbnMgYWZ0ZXIgbGV0dGluZyB1cClcbiAqICAgIC4uLiBib3VuY2UgYmVnaW5zIC4uLlxuICogICAgLi4uIHNvbWUgdGltZSBlbGFwc2VzIC4uLlxuICogICAgLi4uIHBoeXNpY2FsIHRvdWNoIGR1cmluZyBib3VuY2UgLi4uXG4gKiAyLiBgb25Nb21lbnR1bVNjcm9sbEVuZGAgICAoTWFrZXMgbm8gc2Vuc2Ugd2h5IHRoaXMgb2NjdXJzIGZpcnN0IGR1cmluZyBib3VuY2UpXG4gKiAzLiBgb25Ub3VjaFN0YXJ0Q2FwdHVyZWAgICAoaW1tZWRpYXRlbHkgYWZ0ZXIgYG9uTW9tZW50dW1TY3JvbGxFbmRgKVxuICogNC4gYG9uVG91Y2hTdGFydGAgICAgICAgICAgKHNhbWUsIGJ1dCBidWJibGUgcGhhc2UpXG4gKiA1LiBgb25Ub3VjaEVuZGAgICAgICAgICAgICAoWW91IGNvdWxkIGhvbGQgdGhlIHRvdWNoIHN0YXJ0IGZvciBhIGxvbmcgdGltZSlcbiAqIDYuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gIChXaGVuIHJlbGVhc2luZyB0aGUgdmlldyBzdGFydHMgYm91bmNpbmcgYmFjaylcbiAqXG4gKiBTbyB3aGVuIHdlIHJlY2VpdmUgYW4gYG9uVG91Y2hTdGFydGAsIGhvdyBjYW4gd2UgdGVsbCBpZiB3ZSBhcmUgdG91Y2hpbmdcbiAqICpkdXJpbmcqIGFuIGFuaW1hdGlvbiAod2hpY2ggdGhlbiBjYXVzZXMgdGhlIGFuaW1hdGlvbiB0byBzdG9wKT8gVGhlIG9ubHkgd2F5XG4gKiB0byB0ZWxsIGlzIGlmIHRoZSBgdG91Y2hTdGFydGAgb2NjdXJyZWQgaW1tZWRpYXRlbHkgYWZ0ZXIgdGhlXG4gKiBgb25Nb21lbnR1bVNjcm9sbEVuZGAuXG4gKlxuICogVGhpcyBpcyBhYnN0cmFjdGVkIG91dCBmb3IgeW91LCBzbyB5b3UgY2FuIGp1c3QgY2FsbCB0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCkgaWZcbiAqIG5lY2Vzc2FyeVxuICpcbiAqIGBTY3JvbGxSZXNwb25kZXJgIGFsc28gaW5jbHVkZXMgbG9naWMgZm9yIGJsdXJyaW5nIGEgY3VycmVudGx5IGZvY3VzZWQgaW5wdXRcbiAqIGlmIG9uZSBpcyBmb2N1c2VkIHdoaWxlIHNjcm9sbGluZy4gVGhlIGBTY3JvbGxSZXNwb25kZXJgIGlzIGEgbmF0dXJhbCBwbGFjZVxuICogdG8gcHV0IHRoaXMgbG9naWMgc2luY2UgaXQgY2FuIHN1cHBvcnQgbm90IGRpc21pc3NpbmcgdGhlIGtleWJvYXJkIHdoaWxlXG4gKiBzY3JvbGxpbmcsIHVubGVzcyBhIHJlY29nbml6ZWQgXCJ0YXBcIi1saWtlIGdlc3R1cmUgaGFzIG9jY3VycmVkLlxuICpcbiAqIFRoZSBwdWJsaWMgbGlmZWN5Y2xlIEFQSSBpbmNsdWRlcyBldmVudHMgZm9yIGtleWJvYXJkIGludGVyYWN0aW9uLCByZXNwb25kZXJcbiAqIGludGVyYWN0aW9uLCBhbmQgc2Nyb2xsaW5nIChhbW9uZyBvdGhlcnMpLiBUaGUga2V5Ym9hcmQgY2FsbGJhY2tzXG4gKiBgb25LZXlib2FyZFdpbGwvRGlkLypgIGFyZSAqZ2xvYmFsKiBldmVudHMsIGJ1dCBhcmUgaW52b2tlZCBvbiBzY3JvbGxcbiAqIHJlc3BvbmRlcidzIHByb3BzIHNvIHRoYXQgeW91IGNhbiBndWFyYW50ZWUgdGhhdCB0aGUgc2Nyb2xsIHJlc3BvbmRlcidzXG4gKiBpbnRlcm5hbCBzdGF0ZSBoYXMgYmVlbiB1cGRhdGVkIGFjY29yZGluZ2x5IChhbmQgZGV0ZXJtaW5pc3RpY2FsbHkpIGJ5XG4gKiB0aGUgdGltZSB0aGUgcHJvcHMgY2FsbGJhY2tzIGFyZSBpbnZva2UuIE90aGVyd2lzZSwgeW91IHdvdWxkIGFsd2F5cyB3b25kZXJcbiAqIGlmIHRoZSBzY3JvbGwgcmVzcG9uZGVyIGlzIGN1cnJlbnRseSBpbiBhIHN0YXRlIHdoZXJlIGl0IHJlY29nbml6ZXMgbmV3XG4gKiBrZXlib2FyZCBwb3NpdGlvbnMgZXRjLiBJZiBjb29yZGluYXRpbmcgc2Nyb2xsaW5nIHdpdGgga2V5Ym9hcmQgbW92ZW1lbnQsXG4gKiAqYWx3YXlzKiB1c2UgdGhlc2UgaG9va3MgaW5zdGVhZCBvZiBsaXN0ZW5pbmcgdG8geW91ciBvd24gZ2xvYmFsIGtleWJvYXJkXG4gKiBldmVudHMuXG4gKlxuICogUHVibGljIGtleWJvYXJkIGxpZmVjeWNsZSBBUEk6IChwcm9wcyBjYWxsYmFja3MpXG4gKlxuICogU3RhbmRhcmQgS2V5Ym9hcmQgQXBwZWFyYW5jZSBTZXF1ZW5jZTpcbiAqXG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxTaG93XG4gKiAgIHRoaXMucHJvcHMub25LZXlib2FyZERpZFNob3dcbiAqXG4gKiBgb25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZGAgd2lsbCBiZSBpbnZva2VkIGlmIGFuIGFwcHJvcHJpYXRlXG4gKiB0YXAgaW5zaWRlIHRoZSBzY3JvbGwgcmVzcG9uZGVyJ3Mgc2Nyb2xsYWJsZSByZWdpb24gd2FzIHJlc3BvbnNpYmxlXG4gKiBmb3IgdGhlIGRpc21pc3NhbCBvZiB0aGUga2V5Ym9hcmQuIFRoZXJlIGFyZSBvdGhlciByZWFzb25zIHdoeSB0aGVcbiAqIGtleWJvYXJkIGNvdWxkIGJlIGRpc21pc3NlZC5cbiAqXG4gKiAgIHRoaXMucHJvcHMub25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZFxuICpcbiAqIFN0YW5kYXJkIEtleWJvYXJkIEhpZGUgU2VxdWVuY2U6XG4gKlxuICogICB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsSGlkZVxuICogICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRIaWRlXG4gKi9cblxuY29uc3QgSVNfQU5JTUFUSU5HX1RPVUNIX1NUQVJUX1RIUkVTSE9MRF9NUyA9IDE2O1xuXG5leHBvcnQgdHlwZSBTdGF0ZSA9IHt8XG4gIGlzVG91Y2hpbmc6IGJvb2xlYW4sXG4gIGxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZTogbnVtYmVyLFxuICBsYXN0TW9tZW50dW1TY3JvbGxFbmRUaW1lOiBudW1iZXIsXG4gIG9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlcjogYm9vbGVhbixcbiAgYmVjYW1lUmVzcG9uZGVyV2hpbGVBbmltYXRpbmc6IGJvb2xlYW4sXG58fTtcblxuY29uc3QgU2Nyb2xsUmVzcG9uZGVyTWl4aW4gPSB7XG4gIF9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxTaG93OiAobnVsbDogP0VtaXR0ZXJTdWJzY3JpcHRpb24pLFxuICBfc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsSGlkZTogKG51bGw6ID9FbWl0dGVyU3Vic2NyaXB0aW9uKSxcbiAgX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkU2hvdzogKG51bGw6ID9FbWl0dGVyU3Vic2NyaXB0aW9uKSxcbiAgX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkSGlkZTogKG51bGw6ID9FbWl0dGVyU3Vic2NyaXB0aW9uKSxcbiAgc2Nyb2xsUmVzcG9uZGVyTWl4aW5HZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCk6IFN0YXRlIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXNUb3VjaGluZzogZmFsc2UsXG4gICAgICBsYXN0TW9tZW50dW1TY3JvbGxCZWdpblRpbWU6IDAsXG4gICAgICBsYXN0TW9tZW50dW1TY3JvbGxFbmRUaW1lOiAwLFxuXG4gICAgICAvLyBSZXNldCB0byBmYWxzZSBldmVyeSB0aW1lIGJlY29tZXMgcmVzcG9uZGVyLiBUaGlzIGlzIHVzZWQgdG86XG4gICAgICAvLyAtIERldGVybWluZSBpZiB0aGUgc2Nyb2xsIHZpZXcgaGFzIGJlZW4gc2Nyb2xsZWQgYW5kIHRoZXJlZm9yZSBzaG91bGRcbiAgICAgIC8vIHJlZnVzZSB0byBnaXZlIHVwIGl0cyByZXNwb25kZXIgbG9jay5cbiAgICAgIC8vIC0gRGV0ZXJtaW5lIGlmIHJlbGVhc2luZyBzaG91bGQgZGlzbWlzcyB0aGUga2V5Ym9hcmQgd2hlbiB3ZSBhcmUgaW5cbiAgICAgIC8vIHRhcC10by1kaXNtaXNzIG1vZGUgKHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyAhPT0gJ2Fsd2F5cycpLlxuICAgICAgb2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyOiBmYWxzZSxcbiAgICAgIGJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nOiBmYWxzZSxcbiAgICB9O1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblNjcm9sbGAgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxTaG91bGRTZXRSZXNwb25kZXI6IGZ1bmN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIC8vIEFsbG93IGFueSBldmVudCB0b3VjaCBwYXNzIHRocm91Z2ggaWYgdGhlIGRlZmF1bHQgcGFuIHJlc3BvbmRlciBpcyBkaXNhYmxlZFxuICAgIGlmICh0aGlzLnByb3BzLmRpc2FibGVTY3JvbGxWaWV3UGFuUmVzcG9uZGVyID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnN0YXRlLmlzVG91Y2hpbmc7XG4gIH0sXG5cbiAgLyoqXG4gICAqIE1lcmVseSB0b3VjaCBzdGFydGluZyBpcyBub3Qgc3VmZmljaWVudCBmb3IgYSBzY3JvbGwgdmlldyB0byBiZWNvbWUgdGhlXG4gICAqIHJlc3BvbmRlci4gQmVpbmcgdGhlIFwicmVzcG9uZGVyXCIgbWVhbnMgdGhhdCB0aGUgdmVyeSBuZXh0IHRvdWNoIG1vdmUvZW5kXG4gICAqIGV2ZW50IHdpbGwgcmVzdWx0IGluIGFuIGFjdGlvbi9tb3ZlbWVudC5cbiAgICpcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TdGFydFNob3VsZFNldFJlc3BvbmRlcmAgZXZlbnQuXG4gICAqXG4gICAqIGBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyYCBpcyB1c2VkIHdoZW4gdGhlIG5leHQgbW92ZS9lbmQgd2lsbCB0cmlnZ2VyXG4gICAqIHNvbWUgVUkgbW92ZW1lbnQvYWN0aW9uLCBidXQgd2hlbiB5b3Ugd2FudCB0byB5aWVsZCBwcmlvcml0eSB0byB2aWV3c1xuICAgKiBuZXN0ZWQgaW5zaWRlIG9mIHRoZSB2aWV3LlxuICAgKlxuICAgKiBUaGVyZSBtYXkgYmUgc29tZSBjYXNlcyB3aGVyZSBzY3JvbGwgdmlld3MgYWN0dWFsbHkgc2hvdWxkIHJldHVybiBgdHJ1ZWBcbiAgICogZnJvbSBgb25TdGFydFNob3VsZFNldFJlc3BvbmRlcmA6IEFueSB0aW1lIHdlIGFyZSBkZXRlY3RpbmcgYSBzdGFuZGFyZCB0YXBcbiAgICogdGhhdCBnaXZlcyBwcmlvcml0eSB0byBuZXN0ZWQgdmlld3MuXG4gICAqXG4gICAqIC0gSWYgYSBzaW5nbGUgdGFwIG9uIHRoZSBzY3JvbGwgdmlldyB0cmlnZ2VycyBhbiBhY3Rpb24gc3VjaCBhc1xuICAgKiAgIHJlY2VudGVyaW5nIGEgbWFwIHN0eWxlIHZpZXcgeWV0IHdhbnRzIHRvIGdpdmUgcHJpb3JpdHkgdG8gaW50ZXJhY3Rpb25cbiAgICogICB2aWV3cyBpbnNpZGUgKHN1Y2ggYXMgZHJvcHBlZCBwaW5zIG9yIGxhYmVscyksIHRoZW4gd2Ugd291bGQgcmV0dXJuIHRydWVcbiAgICogICBmcm9tIHRoaXMgbWV0aG9kIHdoZW4gdGhlcmUgaXMgYSBzaW5nbGUgdG91Y2guXG4gICAqXG4gICAqIC0gU2ltaWxhciB0byB0aGUgcHJldmlvdXMgY2FzZSwgaWYgYSB0d28gZmluZ2VyIFwidGFwXCIgc2hvdWxkIHRyaWdnZXIgYVxuICAgKiAgIHpvb20sIHdlIHdvdWxkIGNoZWNrIHRoZSBgdG91Y2hlc2AgY291bnQsIGFuZCBpZiBgPj0gMmAsIHdlIHdvdWxkIHJldHVyblxuICAgKiAgIHRydWUuXG4gICAqXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTdGFydFNob3VsZFNldFJlc3BvbmRlcjogZnVuY3Rpb24oXG4gICAgZTogUHJlc3NFdmVudCxcbiAgKTogYm9vbGVhbiB7XG4gICAgLy8gQWxsb3cgYW55IGV2ZW50IHRvdWNoIHBhc3MgdGhyb3VnaCBpZiB0aGUgZGVmYXVsdCBwYW4gcmVzcG9uZGVyIGlzIGRpc2FibGVkXG4gICAgaWYgKHRoaXMucHJvcHMuZGlzYWJsZVNjcm9sbFZpZXdQYW5SZXNwb25kZXIgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50bHlGb2N1c2VkSW5wdXQgPSBUZXh0SW5wdXRTdGF0ZS5jdXJyZW50bHlGb2N1c2VkSW5wdXQoKTtcblxuICAgIGlmIChcbiAgICAgIHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA9PT0gJ2hhbmRsZWQnICYmXG4gICAgICBjdXJyZW50bHlGb2N1c2VkSW5wdXQgIT0gbnVsbCAmJlxuICAgICAgZS50YXJnZXQgIT09IGN1cnJlbnRseUZvY3VzZWRJbnB1dFxuICAgICkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICAvKipcbiAgICogVGhlcmUgYXJlIHRpbWVzIHdoZW4gdGhlIHNjcm9sbCB2aWV3IHdhbnRzIHRvIGJlY29tZSB0aGUgcmVzcG9uZGVyXG4gICAqIChtZWFuaW5nIHJlc3BvbmQgdG8gdGhlIG5leHQgaW1tZWRpYXRlIGB0b3VjaFN0YXJ0L3RvdWNoRW5kYCksIGluIGEgd2F5XG4gICAqIHRoYXQgKmRvZXNuJ3QqIGdpdmUgcHJpb3JpdHkgdG8gbmVzdGVkIHZpZXdzIChoZW5jZSB0aGUgY2FwdHVyZSBwaGFzZSk6XG4gICAqXG4gICAqIC0gQ3VycmVudGx5IGFuaW1hdGluZy5cbiAgICogLSBUYXBwaW5nIGFueXdoZXJlIHRoYXQgaXMgbm90IGEgdGV4dCBpbnB1dCwgd2hpbGUgdGhlIGtleWJvYXJkIGlzXG4gICAqICAgdXAgKHdoaWNoIHNob3VsZCBkaXNtaXNzIHRoZSBrZXlib2FyZCkuXG4gICAqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU3RhcnRTaG91bGRTZXRSZXNwb25kZXJDYXB0dXJlYCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZTogZnVuY3Rpb24oXG4gICAgZTogUHJlc3NFdmVudCxcbiAgKTogYm9vbGVhbiB7XG4gICAgLy8gVGhlIHNjcm9sbCB2aWV3IHNob3VsZCByZWNlaXZlIHRhcHMgaW5zdGVhZCBvZiBpdHMgZGVzY2VuZGFudHMgaWY6XG4gICAgLy8gKiBpdCBpcyBhbHJlYWR5IGFuaW1hdGluZy9kZWNlbGVyYXRpbmdcbiAgICBpZiAodGhpcy5zY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZygpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBBbGxvdyBhbnkgZXZlbnQgdG91Y2ggcGFzcyB0aHJvdWdoIGlmIHRoZSBkZWZhdWx0IHBhbiByZXNwb25kZXIgaXMgZGlzYWJsZWRcbiAgICBpZiAodGhpcy5wcm9wcy5kaXNhYmxlU2Nyb2xsVmlld1BhblJlc3BvbmRlciA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vICogdGhlIGtleWJvYXJkIGlzIHVwLCBrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzIGlzICduZXZlcicgKHRoZSBkZWZhdWx0KSxcbiAgICAvLyBhbmQgYSBuZXcgdG91Y2ggc3RhcnRzIHdpdGggYSBub24tdGV4dGlucHV0IHRhcmdldCAoaW4gd2hpY2ggY2FzZSB0aGVcbiAgICAvLyBmaXJzdCB0YXAgc2hvdWxkIGJlIHNlbnQgdG8gdGhlIHNjcm9sbCB2aWV3IGFuZCBkaXNtaXNzIHRoZSBrZXlib2FyZCxcbiAgICAvLyB0aGVuIHRoZSBzZWNvbmQgdGFwIGdvZXMgdG8gdGhlIGFjdHVhbCBpbnRlcmlvciB2aWV3KVxuICAgIGNvbnN0IGN1cnJlbnRseUZvY3VzZWRUZXh0SW5wdXQgPSBUZXh0SW5wdXRTdGF0ZS5jdXJyZW50bHlGb2N1c2VkSW5wdXQoKTtcbiAgICBjb25zdCB7a2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwc30gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGtleWJvYXJkTmV2ZXJQZXJzaXN0VGFwcyA9XG4gICAgICAha2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyB8fCBrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzID09PSAnbmV2ZXInO1xuXG4gICAgaWYgKHR5cGVvZiBlLnRhcmdldCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGlmIChfX0RFVl9fKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgJ0RpZCBub3QgZXhwZWN0IGV2ZW50IHRhcmdldCB0byBiZSBhIG51bWJlci4gU2hvdWxkIGhhdmUgYmVlbiBhIG5hdGl2ZSBjb21wb25lbnQnLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAga2V5Ym9hcmROZXZlclBlcnNpc3RUYXBzICYmXG4gICAgICBjdXJyZW50bHlGb2N1c2VkVGV4dElucHV0ICE9IG51bGwgJiZcbiAgICAgIGUudGFyZ2V0ICE9IG51bGwgJiZcbiAgICAgICFUZXh0SW5wdXRTdGF0ZS5pc1RleHRJbnB1dChlLnRhcmdldClcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25SZXNwb25kZXJSZWplY3RgIGV2ZW50LlxuICAgKlxuICAgKiBTb21lIG90aGVyIGVsZW1lbnQgaXMgbm90IHlpZWxkaW5nIGl0cyByb2xlIGFzIHJlc3BvbmRlci4gTm9ybWFsbHksIHdlJ2RcbiAgICoganVzdCBkaXNhYmxlIHRoZSBgVUlTY3JvbGxWaWV3YCwgYnV0IGEgdG91Y2ggaGFzIGFscmVhZHkgYmVnYW4gb24gaXQsIHRoZVxuICAgKiBgVUlTY3JvbGxWaWV3YCB3aWxsIG5vdCBhY2NlcHQgYmVpbmcgZGlzYWJsZWQgYWZ0ZXIgdGhhdC4gVGhlIGVhc2llc3RcbiAgICogc29sdXRpb24gZm9yIG5vdyBpcyB0byBhY2NlcHQgdGhlIGxpbWl0YXRpb24gb2YgZGlzYWxsb3dpbmcgdGhpc1xuICAgKiBhbHRvZ2V0aGVyLiBUbyBpbXByb3ZlIHRoaXMsIGZpbmQgYSB3YXkgdG8gZGlzYWJsZSB0aGUgYFVJU2Nyb2xsVmlld2AgYWZ0ZXJcbiAgICogYSB0b3VjaCBoYXMgYWxyZWFkeSBzdGFydGVkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlUmVzcG9uZGVyUmVqZWN0OiBmdW5jdGlvbigpIHt9LFxuXG4gIC8qKlxuICAgKiBXZSB3aWxsIGFsbG93IHRoZSBzY3JvbGwgdmlldyB0byBnaXZlIHVwIGl0cyBsb2NrIGlmZiBpdCBhY3F1aXJlZCB0aGUgbG9ja1xuICAgKiBkdXJpbmcgYW4gYW5pbWF0aW9uLiBUaGlzIGlzIGEgdmVyeSB1c2VmdWwgZGVmYXVsdCB0aGF0IGhhcHBlbnMgdG8gc2F0aXNmeVxuICAgKiBtYW55IGNvbW1vbiB1c2VyIGV4cGVyaWVuY2VzLlxuICAgKlxuICAgKiAtIFN0b3AgYSBzY3JvbGwgb24gdGhlIGxlZnQgZWRnZSwgdGhlbiB0dXJuIHRoYXQgaW50byBhbiBvdXRlciB2aWV3J3NcbiAgICogICBiYWNrc3dpcGUuXG4gICAqIC0gU3RvcCBhIHNjcm9sbCBtaWQtYm91bmNlIGF0IHRoZSB0b3AsIGNvbnRpbnVlIHB1bGxpbmcgdG8gaGF2ZSB0aGUgb3V0ZXJcbiAgICogICB2aWV3IGRpc21pc3MuXG4gICAqIC0gSG93ZXZlciwgd2l0aG91dCBjYXRjaGluZyB0aGUgc2Nyb2xsIHZpZXcgbWlkLWJvdW5jZSAod2hpbGUgaXQgaXNcbiAgICogICBtb3Rpb25sZXNzKSwgaWYgeW91IGRyYWcgZmFyIGVub3VnaCBmb3IgdGhlIHNjcm9sbCB2aWV3IHRvIGJlY29tZVxuICAgKiAgIHJlc3BvbmRlciAoYW5kIHRoZXJlZm9yZSBkcmFnIHRoZSBzY3JvbGwgdmlldyBhIGJpdCksIGFueSBiYWNrc3dpcGVcbiAgICogICBuYXZpZ2F0aW9uIG9mIGEgc3dpcGUgZ2VzdHVyZSBoaWdoZXIgaW4gdGhlIHZpZXcgaGllcmFyY2h5LCBzaG91bGQgYmVcbiAgICogICByZWplY3RlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRlcm1pbmF0aW9uUmVxdWVzdDogZnVuY3Rpb24oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLnN0YXRlLm9ic2VydmVkU2Nyb2xsU2luY2VCZWNvbWluZ1Jlc3BvbmRlcjtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaEVuZGAgZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7UHJlc3NFdmVudH0gZSBFdmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoRW5kOiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgY29uc3QgbmF0aXZlRXZlbnQgPSBlLm5hdGl2ZUV2ZW50O1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IG5hdGl2ZUV2ZW50LnRvdWNoZXMubGVuZ3RoICE9PSAwO1xuICAgIHRoaXMucHJvcHMub25Ub3VjaEVuZCAmJiB0aGlzLnByb3BzLm9uVG91Y2hFbmQoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uVG91Y2hDYW5jZWxgIGV2ZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgRXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaENhbmNlbDogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMuc3RhdGUuaXNUb3VjaGluZyA9IGZhbHNlO1xuICAgIHRoaXMucHJvcHMub25Ub3VjaENhbmNlbCAmJiB0aGlzLnByb3BzLm9uVG91Y2hDYW5jZWwoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uUmVzcG9uZGVyUmVsZWFzZWAgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVSZXNwb25kZXJSZWxlYXNlOiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UgJiYgdGhpcy5wcm9wcy5vblJlc3BvbmRlclJlbGVhc2UoZSk7XG5cbiAgICBpZiAodHlwZW9mIGUudGFyZ2V0ID09PSAnbnVtYmVyJykge1xuICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICAnRGlkIG5vdCBleHBlY3QgZXZlbnQgdGFyZ2V0IHRvIGJlIGEgbnVtYmVyLiBTaG91bGQgaGF2ZSBiZWVuIGEgbmF0aXZlIGNvbXBvbmVudCcsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBCeSBkZWZhdWx0IHNjcm9sbCB2aWV3cyB3aWxsIHVuZm9jdXMgYSB0ZXh0RmllbGRcbiAgICAvLyBpZiBhbm90aGVyIHRvdWNoIG9jY3VycyBvdXRzaWRlIG9mIGl0XG4gICAgY29uc3QgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCA9IFRleHRJbnB1dFN0YXRlLmN1cnJlbnRseUZvY3VzZWRJbnB1dCgpO1xuICAgIGlmIChcbiAgICAgIHRoaXMucHJvcHMua2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyAhPT0gdHJ1ZSAmJlxuICAgICAgdGhpcy5wcm9wcy5rZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzICE9PSAnYWx3YXlzJyAmJlxuICAgICAgY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAhPSBudWxsICYmXG4gICAgICBlLnRhcmdldCAhPT0gY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCAmJlxuICAgICAgIXRoaXMuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyICYmXG4gICAgICAhdGhpcy5zdGF0ZS5iZWNhbWVSZXNwb25kZXJXaGlsZUFuaW1hdGluZ1xuICAgICkge1xuICAgICAgdGhpcy5wcm9wcy5vblNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlzbWlzc2VkICYmXG4gICAgICAgIHRoaXMucHJvcHMub25TY3JvbGxSZXNwb25kZXJLZXlib2FyZERpc21pc3NlZChlKTtcbiAgICAgIFRleHRJbnB1dFN0YXRlLmJsdXJUZXh0SW5wdXQoY3VycmVudGx5Rm9jdXNlZFRleHRJbnB1dCk7XG4gICAgfVxuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVNjcm9sbDogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICAodGhpczogYW55KS5zdGF0ZS5vYnNlcnZlZFNjcm9sbFNpbmNlQmVjb21pbmdSZXNwb25kZXIgPSB0cnVlO1xuICAgICh0aGlzOiBhbnkpLnByb3BzLm9uU2Nyb2xsICYmICh0aGlzOiBhbnkpLnByb3BzLm9uU2Nyb2xsKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvblJlc3BvbmRlckdyYW50YCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVJlc3BvbmRlckdyYW50OiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIHRoaXMuc3RhdGUub2JzZXJ2ZWRTY3JvbGxTaW5jZUJlY29taW5nUmVzcG9uZGVyID0gZmFsc2U7XG4gICAgdGhpcy5wcm9wcy5vblJlc3BvbmRlckdyYW50ICYmIHRoaXMucHJvcHMub25SZXNwb25kZXJHcmFudChlKTtcbiAgICB0aGlzLnN0YXRlLmJlY2FtZVJlc3BvbmRlcldoaWxlQW5pbWF0aW5nID0gdGhpcy5zY3JvbGxSZXNwb25kZXJJc0FuaW1hdGluZygpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBVbmZvcnR1bmF0ZWx5LCBgb25TY3JvbGxCZWdpbkRyYWdgIGFsc28gZmlyZXMgd2hlbiAqc3RvcHBpbmcqIHRoZSBzY3JvbGxcbiAgICogYW5pbWF0aW9uLCBhbmQgdGhlcmUncyBub3QgYW4gZWFzeSB3YXkgdG8gZGlzdGluZ3Vpc2ggYSBkcmFnIHZzLiBzdG9wcGluZ1xuICAgKiBtb21lbnR1bS5cbiAgICpcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25TY3JvbGxCZWdpbkRyYWdgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlU2Nyb2xsQmVnaW5EcmFnOiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIEZyYW1lUmF0ZUxvZ2dlci5iZWdpblNjcm9sbCgpOyAvLyBUT0RPOiB0cmFjayBhbGwgc2Nyb2xscyBhZnRlciBpbXBsZW1lbnRpbmcgb25TY3JvbGxFbmRBbmltYXRpb25cbiAgICB0aGlzLnByb3BzLm9uU2Nyb2xsQmVnaW5EcmFnICYmIHRoaXMucHJvcHMub25TY3JvbGxCZWdpbkRyYWcoZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uU2Nyb2xsRW5kRHJhZ2AgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVTY3JvbGxFbmREcmFnOiBmdW5jdGlvbihlOiBTY3JvbGxFdmVudCkge1xuICAgIGNvbnN0IHt2ZWxvY2l0eX0gPSBlLm5hdGl2ZUV2ZW50O1xuICAgIC8vIC0gSWYgd2UgYXJlIGFuaW1hdGluZywgdGhlbiB0aGlzIGlzIGEgXCJkcmFnXCIgdGhhdCBpcyBzdG9wcGluZyB0aGUgc2Nyb2xsdmlldyBhbmQgbW9tZW50dW0gZW5kXG4gICAgLy8gICB3aWxsIGZpcmUuXG4gICAgLy8gLSBJZiB2ZWxvY2l0eSBpcyBub24temVybywgdGhlbiB0aGUgaW50ZXJhY3Rpb24gd2lsbCBzdG9wIHdoZW4gbW9tZW50dW0gc2Nyb2xsIGVuZHMgb3JcbiAgICAvLyAgIGFub3RoZXIgZHJhZyBzdGFydHMgYW5kIGVuZHMuXG4gICAgLy8gLSBJZiB3ZSBkb24ndCBnZXQgdmVsb2NpdHksIGJldHRlciB0byBzdG9wIHRoZSBpbnRlcmFjdGlvbiB0d2ljZSB0aGFuIG5vdCBzdG9wIGl0LlxuICAgIGlmIChcbiAgICAgICF0aGlzLnNjcm9sbFJlc3BvbmRlcklzQW5pbWF0aW5nKCkgJiZcbiAgICAgICghdmVsb2NpdHkgfHwgKHZlbG9jaXR5LnggPT09IDAgJiYgdmVsb2NpdHkueSA9PT0gMCkpXG4gICAgKSB7XG4gICAgICBGcmFtZVJhdGVMb2dnZXIuZW5kU2Nyb2xsKCk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25TY3JvbGxFbmREcmFnICYmIHRoaXMucHJvcHMub25TY3JvbGxFbmREcmFnKGUpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2UgdGhpcyBmcm9tIGFuIGBvbk1vbWVudHVtU2Nyb2xsQmVnaW5gIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxCZWdpbjogZnVuY3Rpb24oZTogU2Nyb2xsRXZlbnQpIHtcbiAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZSA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsQmVnaW4gJiYgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsQmVnaW4oZSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZSB0aGlzIGZyb20gYW4gYG9uTW9tZW50dW1TY3JvbGxFbmRgIGV2ZW50LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySGFuZGxlTW9tZW50dW1TY3JvbGxFbmQ6IGZ1bmN0aW9uKGU6IFNjcm9sbEV2ZW50KSB7XG4gICAgRnJhbWVSYXRlTG9nZ2VyLmVuZFNjcm9sbCgpO1xuICAgIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZSA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgdGhpcy5wcm9wcy5vbk1vbWVudHVtU2Nyb2xsRW5kICYmIHRoaXMucHJvcHMub25Nb21lbnR1bVNjcm9sbEVuZChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaFN0YXJ0YCBldmVudC5cbiAgICpcbiAgICogU2luY2Ugd2Uga25vdyB0aGF0IHRoZSBgU2ltcGxlRXZlbnRQbHVnaW5gIG9jY3VycyBsYXRlciBpbiB0aGUgcGx1Z2luXG4gICAqIG9yZGVyLCBhZnRlciBgUmVzcG9uZGVyRXZlbnRQbHVnaW5gLCB3ZSBjYW4gZGV0ZWN0IHRoYXQgd2Ugd2VyZSAqbm90KlxuICAgKiBwZXJtaXR0ZWQgdG8gYmUgdGhlIHJlc3BvbmRlciAocHJlc3VtYWJseSBiZWNhdXNlIGEgY29udGFpbmVkIHZpZXcgYmVjYW1lXG4gICAqIHJlc3BvbmRlcikuIFRoZSBgb25SZXNwb25kZXJSZWplY3RgIHdvbid0IGZpcmUgaW4gdGhhdCBjYXNlIC0gaXQgb25seVxuICAgKiBmaXJlcyB3aGVuIGEgKmN1cnJlbnQqIHJlc3BvbmRlciByZWplY3RzIG91ciByZXF1ZXN0LlxuICAgKlxuICAgKiBAcGFyYW0ge1ByZXNzRXZlbnR9IGUgVG91Y2ggU3RhcnQgZXZlbnQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJIYW5kbGVUb3VjaFN0YXJ0OiBmdW5jdGlvbihlOiBQcmVzc0V2ZW50KSB7XG4gICAgdGhpcy5zdGF0ZS5pc1RvdWNoaW5nID0gdHJ1ZTtcbiAgICB0aGlzLnByb3BzLm9uVG91Y2hTdGFydCAmJiB0aGlzLnByb3BzLm9uVG91Y2hTdGFydChlKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlIHRoaXMgZnJvbSBhbiBgb25Ub3VjaE1vdmVgIGV2ZW50LlxuICAgKlxuICAgKiBTaW5jZSB3ZSBrbm93IHRoYXQgdGhlIGBTaW1wbGVFdmVudFBsdWdpbmAgb2NjdXJzIGxhdGVyIGluIHRoZSBwbHVnaW5cbiAgICogb3JkZXIsIGFmdGVyIGBSZXNwb25kZXJFdmVudFBsdWdpbmAsIHdlIGNhbiBkZXRlY3QgdGhhdCB3ZSB3ZXJlICpub3QqXG4gICAqIHBlcm1pdHRlZCB0byBiZSB0aGUgcmVzcG9uZGVyIChwcmVzdW1hYmx5IGJlY2F1c2UgYSBjb250YWluZWQgdmlldyBiZWNhbWVcbiAgICogcmVzcG9uZGVyKS4gVGhlIGBvblJlc3BvbmRlclJlamVjdGAgd29uJ3QgZmlyZSBpbiB0aGF0IGNhc2UgLSBpdCBvbmx5XG4gICAqIGZpcmVzIHdoZW4gYSAqY3VycmVudCogcmVzcG9uZGVyIHJlamVjdHMgb3VyIHJlcXVlc3QuXG4gICAqXG4gICAqIEBwYXJhbSB7UHJlc3NFdmVudH0gZSBUb3VjaCBTdGFydCBldmVudC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckhhbmRsZVRvdWNoTW92ZTogZnVuY3Rpb24oZTogUHJlc3NFdmVudCkge1xuICAgIHRoaXMucHJvcHMub25Ub3VjaE1vdmUgJiYgdGhpcy5wcm9wcy5vblRvdWNoTW92ZShlKTtcbiAgfSxcblxuICAvKipcbiAgICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIHRoaXMgY2xhc3MgdGhhdCBsZXRzIHVzIHF1aWNrbHkgZGV0ZXJtaW5lIGlmIHRoZVxuICAgKiB2aWV3IGlzIGN1cnJlbnRseSBhbmltYXRpbmcuIFRoaXMgaXMgcGFydGljdWxhcmx5IHVzZWZ1bCB0byBrbm93IHdoZW5cbiAgICogYSB0b3VjaCBoYXMganVzdCBzdGFydGVkIG9yIGVuZGVkLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVySXNBbmltYXRpbmc6IGZ1bmN0aW9uKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IHBlcmZvcm1hbmNlTm93KCk7XG4gICAgY29uc3QgdGltZVNpbmNlTGFzdE1vbWVudHVtU2Nyb2xsRW5kID1cbiAgICAgIG5vdyAtIHRoaXMuc3RhdGUubGFzdE1vbWVudHVtU2Nyb2xsRW5kVGltZTtcbiAgICBjb25zdCBpc0FuaW1hdGluZyA9XG4gICAgICB0aW1lU2luY2VMYXN0TW9tZW50dW1TY3JvbGxFbmQgPCBJU19BTklNQVRJTkdfVE9VQ0hfU1RBUlRfVEhSRVNIT0xEX01TIHx8XG4gICAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEVuZFRpbWUgPFxuICAgICAgICB0aGlzLnN0YXRlLmxhc3RNb21lbnR1bVNjcm9sbEJlZ2luVGltZTtcbiAgICByZXR1cm4gaXNBbmltYXRpbmc7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIG5vZGUgdGhhdCByZXByZXNlbnRzIG5hdGl2ZSB2aWV3IHRoYXQgY2FuIGJlIHNjcm9sbGVkLlxuICAgKiBDb21wb25lbnRzIGNhbiBwYXNzIHdoYXQgbm9kZSB0byB1c2UgYnkgZGVmaW5pbmcgYSBgZ2V0U2Nyb2xsYWJsZU5vZGVgXG4gICAqIGZ1bmN0aW9uIG90aGVyd2lzZSBgdGhpc2AgaXMgdXNlZC5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlckdldFNjcm9sbGFibGVOb2RlOiBmdW5jdGlvbigpOiA/bnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGxhYmxlTm9kZVxuICAgICAgPyB0aGlzLmdldFNjcm9sbGFibGVOb2RlKClcbiAgICAgIDogUmVhY3ROYXRpdmUuZmluZE5vZGVIYW5kbGUodGhpcyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEEgaGVscGVyIGZ1bmN0aW9uIHRvIHNjcm9sbCB0byBhIHNwZWNpZmljIHBvaW50IGluIHRoZSBTY3JvbGxWaWV3LlxuICAgKiBUaGlzIGlzIGN1cnJlbnRseSB1c2VkIHRvIGhlbHAgZm9jdXMgY2hpbGQgVGV4dFZpZXdzLCBidXQgY2FuIGFsc29cbiAgICogYmUgdXNlZCB0byBxdWlja2x5IHNjcm9sbCB0byBhbnkgZWxlbWVudCB3ZSB3YW50IHRvIGZvY3VzLiBTeW50YXg6XG4gICAqXG4gICAqIGBzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyhvcHRpb25zOiB7eDogbnVtYmVyID0gMDsgeTogbnVtYmVyID0gMDsgYW5pbWF0ZWQ6IGJvb2xlYW4gPSB0cnVlfSlgXG4gICAqXG4gICAqIE5vdGU6IFRoZSB3ZWlyZCBhcmd1bWVudCBzaWduYXR1cmUgaXMgZHVlIHRvIHRoZSBmYWN0IHRoYXQsIGZvciBoaXN0b3JpY2FsIHJlYXNvbnMsXG4gICAqIHRoZSBmdW5jdGlvbiBhbHNvIGFjY2VwdHMgc2VwYXJhdGUgYXJndW1lbnRzIGFzIGFzIGFsdGVybmF0aXZlIHRvIHRoZSBvcHRpb25zIG9iamVjdC5cbiAgICogVGhpcyBpcyBkZXByZWNhdGVkIGR1ZSB0byBhbWJpZ3VpdHkgKHkgYmVmb3JlIHgpLCBhbmQgU0hPVUxEIE5PVCBCRSBVU0VELlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG86IGZ1bmN0aW9uKFxuICAgIHg/OlxuICAgICAgfCBudW1iZXJcbiAgICAgIHwge1xuICAgICAgICAgIHg/OiBudW1iZXIsXG4gICAgICAgICAgeT86IG51bWJlcixcbiAgICAgICAgICBhbmltYXRlZD86IGJvb2xlYW4sXG4gICAgICAgICAgLi4uXG4gICAgICAgIH0sXG4gICAgeT86IG51bWJlcixcbiAgICBhbmltYXRlZD86IGJvb2xlYW4sXG4gICkge1xuICAgIGlmICh0eXBlb2YgeCA9PT0gJ251bWJlcicpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgJ2BzY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh4LCB5LCBhbmltYXRlZClgIGlzIGRlcHJlY2F0ZWQuIFVzZSBgc2Nyb2xsUmVzcG9uZGVyU2Nyb2xsVG8oe3g6IDUsIHk6IDUsIGFuaW1hdGVkOiB0cnVlfSlgIGluc3RlYWQuJyxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgICh7eCwgeSwgYW5pbWF0ZWR9ID0geCB8fCB7fSk7XG4gICAgfVxuXG4gICAgY29uc3QgdGhhdDogUmVhY3QuRWxlbWVudFJlZjxTY3JvbGxWaWV3PiA9ICh0aGlzOiBhbnkpO1xuICAgIGludmFyaWFudChcbiAgICAgIHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmICE9IG51bGwsXG4gICAgICAnRXhwZWN0ZWQgc2Nyb2xsVG8gdG8gYmUgY2FsbGVkIG9uIGEgc2Nyb2xsVmlld1JlZi4gSWYgdGhpcyBleGNlcHRpb24gb2NjdXJzIGl0IGlzIGxpa2VseSBhIGJ1ZyBpbiBSZWFjdCBOYXRpdmUnLFxuICAgICk7XG4gICAgY29uc3QgbmF0aXZlU2Nyb2xsUmVmID0gdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYoKTtcbiAgICBpZiAobmF0aXZlU2Nyb2xsUmVmID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgQ29tbWFuZHMuc2Nyb2xsVG8obmF0aXZlU2Nyb2xsUmVmLCB4IHx8IDAsIHkgfHwgMCwgYW5pbWF0ZWQgIT09IGZhbHNlKTtcbiAgfSxcblxuICAvKipcbiAgICogU2Nyb2xscyB0byB0aGUgZW5kIG9mIHRoZSBTY3JvbGxWaWV3LCBlaXRoZXIgaW1tZWRpYXRlbHkgb3Igd2l0aCBhIHNtb290aFxuICAgKiBhbmltYXRpb24uXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqXG4gICAqIGBzY3JvbGxSZXNwb25kZXJTY3JvbGxUb0VuZCh7YW5pbWF0ZWQ6IHRydWV9KWBcbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbFRvRW5kOiBmdW5jdGlvbihvcHRpb25zPzoge2FuaW1hdGVkPzogYm9vbGVhbiwgLi4ufSkge1xuICAgIC8vIERlZmF1bHQgdG8gdHJ1ZVxuICAgIGNvbnN0IGFuaW1hdGVkID0gKG9wdGlvbnMgJiYgb3B0aW9ucy5hbmltYXRlZCkgIT09IGZhbHNlO1xuXG4gICAgY29uc3QgdGhhdDogUmVhY3QuRWxlbWVudFJlZjxTY3JvbGxWaWV3PiA9ICh0aGlzOiBhbnkpO1xuICAgIGludmFyaWFudChcbiAgICAgIHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmICE9IG51bGwsXG4gICAgICAnRXhwZWN0ZWQgc2Nyb2xsVG9FbmQgdG8gYmUgY2FsbGVkIG9uIGEgc2Nyb2xsVmlld1JlZi4gSWYgdGhpcyBleGNlcHRpb24gb2NjdXJzIGl0IGlzIGxpa2VseSBhIGJ1ZyBpbiBSZWFjdCBOYXRpdmUnLFxuICAgICk7XG4gICAgY29uc3QgbmF0aXZlU2Nyb2xsUmVmID0gdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYoKTtcbiAgICBpZiAobmF0aXZlU2Nyb2xsUmVmID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBDb21tYW5kcy5zY3JvbGxUb0VuZChuYXRpdmVTY3JvbGxSZWYsIGFuaW1hdGVkKTtcbiAgfSxcblxuICAvKipcbiAgICogQSBoZWxwZXIgZnVuY3Rpb24gdG8gem9vbSB0byBhIHNwZWNpZmljIHJlY3QgaW4gdGhlIHNjcm9sbHZpZXcuIFRoZSBhcmd1bWVudCBoYXMgdGhlIHNoYXBlXG4gICAqIHt4OiBudW1iZXI7IHk6IG51bWJlcjsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXI7IGFuaW1hdGVkOiBib29sZWFuID0gdHJ1ZX1cbiAgICpcbiAgICogQHBsYXRmb3JtIGlvc1xuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyWm9vbVRvOiBmdW5jdGlvbihcbiAgICByZWN0OiB7fFxuICAgICAgeDogbnVtYmVyLFxuICAgICAgeTogbnVtYmVyLFxuICAgICAgd2lkdGg6IG51bWJlcixcbiAgICAgIGhlaWdodDogbnVtYmVyLFxuICAgICAgYW5pbWF0ZWQ/OiBib29sZWFuLFxuICAgIHx9LFxuICAgIGFuaW1hdGVkPzogYm9vbGVhbiwgLy8gZGVwcmVjYXRlZCwgcHV0IHRoaXMgaW5zaWRlIHRoZSByZWN0IGFyZ3VtZW50IGluc3RlYWRcbiAgKSB7XG4gICAgaW52YXJpYW50KFBsYXRmb3JtLk9TID09PSAnaW9zJywgJ3pvb21Ub1JlY3QgaXMgbm90IGltcGxlbWVudGVkJyk7XG4gICAgaWYgKCdhbmltYXRlZCcgaW4gcmVjdCkge1xuICAgICAgYW5pbWF0ZWQgPSByZWN0LmFuaW1hdGVkO1xuICAgICAgZGVsZXRlIHJlY3QuYW5pbWF0ZWQ7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgYW5pbWF0ZWQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdgc2Nyb2xsUmVzcG9uZGVyWm9vbVRvYCBgYW5pbWF0ZWRgIGFyZ3VtZW50IGlzIGRlcHJlY2F0ZWQuIFVzZSBgb3B0aW9ucy5hbmltYXRlZGAgaW5zdGVhZCcsXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHRoYXQ6IFJlYWN0LkVsZW1lbnRSZWY8U2Nyb2xsVmlldz4gPSB0aGlzO1xuICAgIGludmFyaWFudChcbiAgICAgIHRoYXQuZ2V0TmF0aXZlU2Nyb2xsUmVmICE9IG51bGwsXG4gICAgICAnRXhwZWN0ZWQgem9vbVRvUmVjdCB0byBiZSBjYWxsZWQgb24gYSBzY3JvbGxWaWV3UmVmLiBJZiB0aGlzIGV4Y2VwdGlvbiBvY2N1cnMgaXQgaXMgbGlrZWx5IGEgYnVnIGluIFJlYWN0IE5hdGl2ZScsXG4gICAgKTtcbiAgICBjb25zdCBuYXRpdmVTY3JvbGxSZWYgPSB0aGF0LmdldE5hdGl2ZVNjcm9sbFJlZigpO1xuICAgIGlmIChuYXRpdmVTY3JvbGxSZWYgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBDb21tYW5kcy56b29tVG9SZWN0KG5hdGl2ZVNjcm9sbFJlZiwgcmVjdCwgYW5pbWF0ZWQgIT09IGZhbHNlKTtcbiAgfSxcblxuICAvKipcbiAgICogRGlzcGxheXMgdGhlIHNjcm9sbCBpbmRpY2F0b3JzIG1vbWVudGFyaWx5LlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyRmxhc2hTY3JvbGxJbmRpY2F0b3JzOiBmdW5jdGlvbigpIHtcbiAgICBjb25zdCB0aGF0OiBSZWFjdC5FbGVtZW50UmVmPFNjcm9sbFZpZXc+ID0gKHRoaXM6IGFueSk7XG4gICAgaW52YXJpYW50KFxuICAgICAgdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYgIT0gbnVsbCxcbiAgICAgICdFeHBlY3RlZCBmbGFzaFNjcm9sbEluZGljYXRvcnMgdG8gYmUgY2FsbGVkIG9uIGEgc2Nyb2xsVmlld1JlZi4gSWYgdGhpcyBleGNlcHRpb24gb2NjdXJzIGl0IGlzIGxpa2VseSBhIGJ1ZyBpbiBSZWFjdCBOYXRpdmUnLFxuICAgICk7XG4gICAgY29uc3QgbmF0aXZlU2Nyb2xsUmVmID0gdGhhdC5nZXROYXRpdmVTY3JvbGxSZWYoKTtcbiAgICBpZiAobmF0aXZlU2Nyb2xsUmVmID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgQ29tbWFuZHMuZmxhc2hTY3JvbGxJbmRpY2F0b3JzKG5hdGl2ZVNjcm9sbFJlZik7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSB1c2VkIGFzIHRoZSBjYWxsYmFjayB0byBvbkZvY3VzIGluIGEgVGV4dElucHV0cydcbiAgICogcGFyZW50IHZpZXcuIE5vdGUgdGhhdCBhbnkgbW9kdWxlIHVzaW5nIHRoaXMgbWl4aW4gbmVlZHMgdG8gcmV0dXJuXG4gICAqIHRoZSBwYXJlbnQgdmlldydzIHJlZiBpbiBnZXRTY3JvbGxWaWV3UmVmKCkgaW4gb3JkZXIgdG8gdXNlIHRoaXMgbWV0aG9kLlxuICAgKiBAcGFyYW0ge251bWJlcn0gbm9kZUhhbmRsZSBUaGUgVGV4dElucHV0IG5vZGUgaGFuZGxlXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBhZGRpdGlvbmFsT2Zmc2V0IFRoZSBzY3JvbGwgdmlldydzIGJvdHRvbSBcImNvbnRlbnRJbnNldFwiLlxuICAgKiAgICAgICAgRGVmYXVsdCBpcyAwLlxuICAgKiBAcGFyYW0ge2Jvb2x9IHByZXZlbnROZWdhdGl2ZVNjcm9sbGluZyBXaGV0aGVyIHRvIGFsbG93IHB1bGxpbmcgdGhlIGNvbnRlbnRcbiAgICogICAgICAgIGRvd24gdG8gbWFrZSBpdCBtZWV0IHRoZSBrZXlib2FyZCdzIHRvcC4gRGVmYXVsdCBpcyBmYWxzZS5cbiAgICovXG4gIHNjcm9sbFJlc3BvbmRlclNjcm9sbE5hdGl2ZUhhbmRsZVRvS2V5Ym9hcmQ6IGZ1bmN0aW9uPFQ+KFxuICAgIG5vZGVIYW5kbGU6IG51bWJlciB8IFJlYWN0LkVsZW1lbnRSZWY8SG9zdENvbXBvbmVudDxUPj4sXG4gICAgYWRkaXRpb25hbE9mZnNldD86IG51bWJlcixcbiAgICBwcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQ/OiBib29sZWFuLFxuICApIHtcbiAgICB0aGlzLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQgPSBhZGRpdGlvbmFsT2Zmc2V0IHx8IDA7XG4gICAgdGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQgPSAhIXByZXZlbnROZWdhdGl2ZVNjcm9sbE9mZnNldDtcblxuICAgIGlmICh0eXBlb2Ygbm9kZUhhbmRsZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIFVJTWFuYWdlci5tZWFzdXJlTGF5b3V0KFxuICAgICAgICBub2RlSGFuZGxlLFxuICAgICAgICBSZWFjdE5hdGl2ZS5maW5kTm9kZUhhbmRsZSh0aGlzLmdldElubmVyVmlld05vZGUoKSksXG4gICAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVyVGV4dElucHV0Rm9jdXNFcnJvcixcbiAgICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkLFxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgaW5uZXJSZWYgPSB0aGlzLmdldElubmVyVmlld1JlZigpO1xuXG4gICAgICBpZiAoaW5uZXJSZWYgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG5vZGVIYW5kbGUubWVhc3VyZUxheW91dChcbiAgICAgICAgaW5uZXJSZWYsXG4gICAgICAgIHRoaXMuc2Nyb2xsUmVzcG9uZGVySW5wdXRNZWFzdXJlQW5kU2Nyb2xsVG9LZXlib2FyZCxcbiAgICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yLFxuICAgICAgKTtcbiAgICB9XG4gIH0sXG5cbiAgLyoqXG4gICAqIFRoZSBjYWxjdWxhdGlvbnMgcGVyZm9ybWVkIGhlcmUgYXNzdW1lIHRoZSBzY3JvbGwgdmlldyB0YWtlcyB1cCB0aGUgZW50aXJlXG4gICAqIHNjcmVlbiAtIGV2ZW4gaWYgaGFzIHNvbWUgY29udGVudCBpbnNldC4gV2UgdGhlbiBtZWFzdXJlIHRoZSBvZmZzZXRzIG9mIHRoZVxuICAgKiBrZXlib2FyZCwgYW5kIGNvbXBlbnNhdGUgYm90aCBmb3IgdGhlIHNjcm9sbCB2aWV3J3MgXCJjb250ZW50SW5zZXRcIi5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IGxlZnQgUG9zaXRpb24gb2YgaW5wdXQgdy5yLnQuIHRhYmxlIHZpZXcuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0b3AgUG9zaXRpb24gb2YgaW5wdXQgdy5yLnQuIHRhYmxlIHZpZXcuXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCBXaWR0aCBvZiB0aGUgdGV4dCBpbnB1dC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCBIZWlnaHQgb2YgdGhlIHRleHQgaW5wdXQuXG4gICAqL1xuICBzY3JvbGxSZXNwb25kZXJJbnB1dE1lYXN1cmVBbmRTY3JvbGxUb0tleWJvYXJkOiBmdW5jdGlvbihcbiAgICBsZWZ0OiBudW1iZXIsXG4gICAgdG9wOiBudW1iZXIsXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgKSB7XG4gICAgbGV0IGtleWJvYXJkU2NyZWVuWSA9IERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKS5oZWlnaHQ7XG4gICAgaWYgKHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvKSB7XG4gICAgICBrZXlib2FyZFNjcmVlblkgPSB0aGlzLmtleWJvYXJkV2lsbE9wZW5Uby5lbmRDb29yZGluYXRlcy5zY3JlZW5ZO1xuICAgIH1cbiAgICBsZXQgc2Nyb2xsT2Zmc2V0WSA9XG4gICAgICB0b3AgLSBrZXlib2FyZFNjcmVlblkgKyBoZWlnaHQgKyB0aGlzLmFkZGl0aW9uYWxTY3JvbGxPZmZzZXQ7XG5cbiAgICAvLyBCeSBkZWZhdWx0LCB0aGlzIGNhbiBzY3JvbGwgd2l0aCBuZWdhdGl2ZSBvZmZzZXQsIHB1bGxpbmcgdGhlIGNvbnRlbnRcbiAgICAvLyBkb3duIHNvIHRoYXQgdGhlIHRhcmdldCBjb21wb25lbnQncyBib3R0b20gbWVldHMgdGhlIGtleWJvYXJkJ3MgdG9wLlxuICAgIC8vIElmIHJlcXVlc3RlZCBvdGhlcndpc2UsIGNhcCB0aGUgb2Zmc2V0IGF0IDAgbWluaW11bSB0byBhdm9pZCBjb250ZW50XG4gICAgLy8gc2hpZnRpbmcgZG93bi5cbiAgICBpZiAodGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQpIHtcbiAgICAgIHNjcm9sbE9mZnNldFkgPSBNYXRoLm1heCgwLCBzY3JvbGxPZmZzZXRZKTtcbiAgICB9XG4gICAgdGhpcy5zY3JvbGxSZXNwb25kZXJTY3JvbGxUbyh7eDogMCwgeTogc2Nyb2xsT2Zmc2V0WSwgYW5pbWF0ZWQ6IHRydWV9KTtcblxuICAgIHRoaXMuYWRkaXRpb25hbE9mZnNldCA9IDA7XG4gICAgdGhpcy5wcmV2ZW50TmVnYXRpdmVTY3JvbGxPZmZzZXQgPSBmYWxzZTtcbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJUZXh0SW5wdXRGb2N1c0Vycm9yOiBmdW5jdGlvbihtc2c6IHN0cmluZykge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1lYXN1cmluZyB0ZXh0IGZpZWxkOiAnLCBtc2cpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBgY29tcG9uZW50V2lsbE1vdW50YCBpcyB0aGUgY2xvc2VzdCB0aGluZyB0byBhICBzdGFuZGFyZCBcImNvbnN0cnVjdG9yXCIgZm9yXG4gICAqIFJlYWN0IGNvbXBvbmVudHMuXG4gICAqXG4gICAqIFRoZSBga2V5Ym9hcmRXaWxsU2hvd2AgaXMgY2FsbGVkIGJlZm9yZSBpbnB1dCBmb2N1cy5cbiAgICovXG4gIFVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIGNvbnN0IHtrZXlib2FyZFNob3VsZFBlcnNpc3RUYXBzfSA9ICgodGhpczogYW55KS5wcm9wczogU2Nyb2xsVmlld1Byb3BzKTtcbiAgICBpZiAodHlwZW9mIGtleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHMgPT09ICdib29sZWFuJykge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBgJ2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHM9eyR7XG4gICAgICAgICAga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA9PT0gdHJ1ZSA/ICd0cnVlJyA6ICdmYWxzZSdcbiAgICAgICAgfX0nIGlzIGRlcHJlY2F0ZWQuIGAgK1xuICAgICAgICAgIGBVc2UgJ2tleWJvYXJkU2hvdWxkUGVyc2lzdFRhcHM9XCIke1xuICAgICAgICAgICAga2V5Ym9hcmRTaG91bGRQZXJzaXN0VGFwcyA/ICdhbHdheXMnIDogJ25ldmVyJ1xuICAgICAgICAgIH1cIicgaW5zdGVhZGAsXG4gICAgICApO1xuICAgIH1cblxuICAgICh0aGlzOiBhbnkpLmtleWJvYXJkV2lsbE9wZW5UbyA9IG51bGw7XG4gICAgKHRoaXM6IGFueSkuYWRkaXRpb25hbFNjcm9sbE9mZnNldCA9IDA7XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsU2hvdyA9IEtleWJvYXJkLmFkZExpc3RlbmVyKFxuICAgICAgJ2tleWJvYXJkV2lsbFNob3cnLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxTaG93LFxuICAgICk7XG5cbiAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZFdpbGxIaWRlID0gS2V5Ym9hcmQuYWRkTGlzdGVuZXIoXG4gICAgICAna2V5Ym9hcmRXaWxsSGlkZScsXG4gICAgICB0aGlzLnNjcm9sbFJlc3BvbmRlcktleWJvYXJkV2lsbEhpZGUsXG4gICAgKTtcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZFNob3cgPSBLZXlib2FyZC5hZGRMaXN0ZW5lcihcbiAgICAgICdrZXlib2FyZERpZFNob3cnLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZFNob3csXG4gICAgKTtcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZEhpZGUgPSBLZXlib2FyZC5hZGRMaXN0ZW5lcihcbiAgICAgICdrZXlib2FyZERpZEhpZGUnLFxuICAgICAgdGhpcy5zY3JvbGxSZXNwb25kZXJLZXlib2FyZERpZEhpZGUsXG4gICAgKTtcbiAgfSxcblxuICBjb21wb25lbnRXaWxsVW5tb3VudDogZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbFNob3cgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsU2hvdy5yZW1vdmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkV2lsbEhpZGUgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmRXaWxsSGlkZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX3N1YnNjcmlwdGlvbktleWJvYXJkRGlkU2hvdyAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZFNob3cucmVtb3ZlKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9zdWJzY3JpcHRpb25LZXlib2FyZERpZEhpZGUgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uS2V5Ym9hcmREaWRIaWRlLnJlbW92ZSgpO1xuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogV2FybmluZywgdGhpcyBtYXkgYmUgY2FsbGVkIHNldmVyYWwgdGltZXMgZm9yIGEgc2luZ2xlIGtleWJvYXJkIG9wZW5pbmcuXG4gICAqIEl0J3MgYmVzdCB0byBzdG9yZSB0aGUgaW5mb3JtYXRpb24gaW4gdGhpcyBtZXRob2QgYW5kIHRoZW4gdGFrZSBhbnkgYWN0aW9uXG4gICAqIGF0IGEgbGF0ZXIgcG9pbnQgKGVpdGhlciBpbiBga2V5Ym9hcmREaWRTaG93YCBvciBvdGhlcikuXG4gICAqXG4gICAqIEhlcmUncyB0aGUgb3JkZXIgdGhhdCBldmVudHMgb2NjdXIgaW46XG4gICAqIC0gZm9jdXNcbiAgICogLSB3aWxsU2hvdyB7c3RhcnRDb29yZGluYXRlcywgZW5kQ29vcmRpbmF0ZXN9IHNldmVyYWwgdGltZXNcbiAgICogLSBkaWRTaG93IHNldmVyYWwgdGltZXNcbiAgICogLSBibHVyXG4gICAqIC0gd2lsbEhpZGUge3N0YXJ0Q29vcmRpbmF0ZXMsIGVuZENvb3JkaW5hdGVzfSBzZXZlcmFsIHRpbWVzXG4gICAqIC0gZGlkSGlkZSBzZXZlcmFsIHRpbWVzXG4gICAqXG4gICAqIFRoZSBgU2Nyb2xsUmVzcG9uZGVyYCBtb2R1bGUgY2FsbGJhY2tzIGZvciBlYWNoIG9mIHRoZXNlIGV2ZW50cy5cbiAgICogRXZlbiB0aG91Z2ggYW55IHVzZXIgY291bGQgaGF2ZSBlYXNpbHkgbGlzdGVuZWQgdG8ga2V5Ym9hcmQgZXZlbnRzXG4gICAqIHRoZW1zZWx2ZXMsIHVzaW5nIHRoZXNlIGBwcm9wc2AgY2FsbGJhY2tzIGVuc3VyZXMgdGhhdCBvcmRlcmluZyBvZiBldmVudHNcbiAgICogaXMgY29uc2lzdGVudCAtIGFuZCBub3QgZGVwZW5kZW50IG9uIHRoZSBvcmRlciB0aGF0IHRoZSBrZXlib2FyZCBldmVudHMgYXJlXG4gICAqIHN1YnNjcmliZWQgdG8uIFRoaXMgbWF0dGVycyB3aGVuIHRlbGxpbmcgdGhlIHNjcm9sbCB2aWV3IHRvIHNjcm9sbCB0byB3aGVyZVxuICAgKiB0aGUga2V5Ym9hcmQgaXMgaGVhZGVkIC0gdGhlIHNjcm9sbCByZXNwb25kZXIgYmV0dGVyIGhhdmUgYmVlbiBub3RpZmllZCBvZlxuICAgKiB0aGUga2V5Ym9hcmQgZGVzdGluYXRpb24gYmVmb3JlIGJlaW5nIGluc3RydWN0ZWQgdG8gc2Nyb2xsIHRvIHdoZXJlIHRoZVxuICAgKiBrZXlib2FyZCB3aWxsIGJlLiBTdGljayB0byB0aGUgYFNjcm9sbFJlc3BvbmRlcmAgY2FsbGJhY2tzLCBhbmQgZXZlcnl0aGluZ1xuICAgKiB3aWxsIHdvcmsuXG4gICAqXG4gICAqIFdBUk5JTkc6IFRoZXNlIGNhbGxiYWNrcyB3aWxsIGZpcmUgZXZlbiBpZiBhIGtleWJvYXJkIGlzIGRpc3BsYXllZCBpbiBhXG4gICAqIGRpZmZlcmVudCBuYXZpZ2F0aW9uIHBhbmUuIEZpbHRlciBvdXQgdGhlIGV2ZW50cyB0byBkZXRlcm1pbmUgaWYgdGhleSBhcmVcbiAgICogcmVsZXZhbnQgdG8geW91LiAoRm9yIGV4YW1wbGUsIG9ubHkgaWYgeW91IHJlY2VpdmUgdGhlc2UgY2FsbGJhY2tzIGFmdGVyXG4gICAqIHlvdSBoYWQgZXhwbGljaXRseSBmb2N1c2VkIGEgbm9kZSBldGMpLlxuICAgKi9cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmRXaWxsU2hvdzogZnVuY3Rpb24oZTogS2V5Ym9hcmRFdmVudCkge1xuICAgIHRoaXMua2V5Ym9hcmRXaWxsT3BlblRvID0gZTtcbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsU2hvdyAmJiB0aGlzLnByb3BzLm9uS2V5Ym9hcmRXaWxsU2hvdyhlKTtcbiAgfSxcblxuICBzY3JvbGxSZXNwb25kZXJLZXlib2FyZFdpbGxIaWRlOiBmdW5jdGlvbihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8gPSBudWxsO1xuICAgIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxIaWRlICYmIHRoaXMucHJvcHMub25LZXlib2FyZFdpbGxIaWRlKGUpO1xuICB9LFxuXG4gIHNjcm9sbFJlc3BvbmRlcktleWJvYXJkRGlkU2hvdzogZnVuY3Rpb24oZTogS2V5Ym9hcmRFdmVudCkge1xuICAgIC8vIFRPRE8oNzY5Mzk2MSk6IFRoZSBldmVudCBmb3IgRGlkU2hvdyBpcyBub3QgYXZhaWxhYmxlIG9uIGlPUyB5ZXQuXG4gICAgLy8gVXNlIHRoZSBvbmUgZnJvbSBXaWxsU2hvdyBhbmQgZG8gbm90IGFzc2lnbi5cbiAgICBpZiAoZSkge1xuICAgICAgdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8gPSBlO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uS2V5Ym9hcmREaWRTaG93ICYmIHRoaXMucHJvcHMub25LZXlib2FyZERpZFNob3coZSk7XG4gIH0sXG5cbiAgc2Nyb2xsUmVzcG9uZGVyS2V5Ym9hcmREaWRIaWRlOiBmdW5jdGlvbihlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgdGhpcy5rZXlib2FyZFdpbGxPcGVuVG8gPSBudWxsO1xuICAgIHRoaXMucHJvcHMub25LZXlib2FyZERpZEhpZGUgJiYgdGhpcy5wcm9wcy5vbktleWJvYXJkRGlkSGlkZShlKTtcbiAgfSxcbn07XG5cbmNvbnN0IFNjcm9sbFJlc3BvbmRlciA9IHtcbiAgTWl4aW46IFNjcm9sbFJlc3BvbmRlck1peGluLFxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBTY3JvbGxSZXNwb25kZXI7XG4iXX0=